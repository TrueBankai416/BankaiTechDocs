---
title: Content Security Policy (CSP) Issues
tags:
   - Docusaurus
   - Nginx
   - CSP
   - Content Security Policy
   - Troubleshooting

keywords: [Docusaurus, CSP, Content Security Policy, Nginx, External Services]
last_update:
  author: BankaiTech
---

import BuyMeACoffeeButton from '@site/src/components/BuyMeACoffeeButton';

# **Content Security Policy (CSP) Issues**

If you're using nginx to serve your Docusaurus site and encountering Content Security Policy (CSP) errors, this guide will help you fix them.

## ***Common CSP Errors***

You might see errors like these in your browser console:

```
Content-Security-Policy: The page's settings blocked a script (script-src-elem)
Content-Security-Policy: The page's settings blocked the loading of a resource (img-src) 
Content-Security-Policy: The page's settings blocked the loading of a resource (connect-src)
```

## ***Understanding CSP***

Content Security Policy is a security feature that helps prevent XSS attacks by controlling which resources can be loaded. However, it can also block legitimate external services used by your Docusaurus site.

### **Common External Services**

Modern Docusaurus sites often use:
- **Analytics services** for tracking
- **Widget services** for donations/support
- **Search services** for AI-powered search
- **SVG Data URIs** for icons and graphics

## ***Nginx CSP Configuration***

Add these CSP headers to your nginx configuration to allow required external resources:

```nginx title="CSP Configuration for nginx" showLineNumbers
server {
    listen 443 ssl;
    http2 on;
    server_name your-domain.com;
    
    # Your existing SSL and other configurations...
    
    # Content Security Policy Headers
    add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' 
            https://external-analytics-service.com 
            https://widget-service.com;
        img-src 'self' 
            https://external-analytics-service.com 
            data:;
        connect-src 'self'
            https://search-service.com
            https://analytics-service.com;
        style-src 'self' 'unsafe-inline';
        font-src 'self' data:;
        frame-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    " always;
    
    # Your existing location blocks...
    location / {
        # Your proxy configuration
    }
}
```

## ***Minimal CSP Configuration***

For a basic setup, use this minimal configuration:

```nginx title="Minimal CSP Configuration" showLineNumbers
# Add to your nginx server block
add_header Content-Security-Policy "
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 
        https://your-analytics-domain.com 
        https://your-widget-domain.com;
    img-src 'self' data:;
    connect-src 'self' 
        https://your-api-domain.com;
    style-src 'self' 'unsafe-inline';
" always;
```

## ***Directive Explanations***

### **script-src**
Controls which scripts can be executed:
- `'self'`: Scripts from your own domain
- `'unsafe-inline'`: Inline scripts (required by Docusaurus)
- `'unsafe-eval'`: Dynamic code evaluation (required by some components)
- External domains for analytics and widgets

### **img-src**
Controls which images can be loaded:
- `'self'`: Images from your own domain
- `data:`: Data URIs for SVG icons and graphics

### **connect-src**
Controls which URLs can be loaded using AJAX, WebSockets, etc.:
- `'self'`: Your own domain
- External services and analytics

## ***Implementation Steps***

1. **Identify your external services** by checking browser console errors
2. **Update your nginx configuration** with the appropriate domains
3. **Test the configuration**:
   ```bash
   sudo nginx -t
   sudo systemctl reload nginx
   ```
4. **Verify functionality** works as expected

## ***Troubleshooting Tips***

### **Configuration Not Working?**

1. **Check nginx syntax**:
   ```bash
   sudo nginx -t
   ```

2. **Verify headers are being sent**:
   ```bash
   curl -I https://your-domain.com
   ```

3. **Check nginx error logs**:
   ```bash
   sudo tail -f /var/log/nginx/error.log
   ```

### **Still Getting Errors?**

If you're still seeing CSP errors after applying the configuration:

1. **Check for multiple CSP headers** - only one should be present
2. **Ensure no conflicting CSP in your application**
3. **Verify the domain names match exactly** (check browser console for exact URLs)

### **Adding New External Services**

When adding new external services to your Docusaurus site:

1. **Check browser console** for CSP errors
2. **Identify the blocked domain** from the error message
3. **Add the domain** to the appropriate CSP directive
4. **Test thoroughly** after making changes

## ***Security Considerations***

- **Use specific domains** instead of wildcards when possible
- **Avoid 'unsafe-eval'** if your site doesn't require it
- **Regularly review** your CSP policy as you add new features
- **Test in multiple browsers** to ensure compatibility
- **Monitor for new CSP violations** in production

## ***Common Domain Patterns***

Replace the example domains in the configuration with your actual service domains:

- **Analytics**: Usually have domains ending in analytics-related TLDs
- **CDN Services**: Often use CDN-specific domain patterns
- **Widget Services**: Typically have widget or button-related domains
- **Search Services**: Usually have search or AI-related domain names

<BuyMeACoffeeButton />
