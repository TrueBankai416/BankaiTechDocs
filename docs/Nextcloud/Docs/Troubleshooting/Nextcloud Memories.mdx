---
title: Nextcloud Memories
sidebar_position: 2
tags:
   - Docker
   - Nextcloud
   - Tutorial
   - Troubleshooting
keywords: [Docker, Docker Engine, Tutorial, Nextcloud, Troubleshootiing]
last_update:
  author: BankaiTech
---
import BuyMeACoffeeButton from '@site/src/components/BuyMeACoffeeButton';

## Troubleshooting for Nextcloud Memories

### Geometry table has not been created

![Geometry Table](/img/nextcloud/Troubleshooting/GeoTable.jpg)
<p>
<>Run the following command.</>
</p>
```bash
sudo docker exec -it -u 33 nextcloud php occ memories:places-setup
```

### ***Database triggers are not set up correctly.***

<p>
<>You need to add `--log_bin_trust_function_creators=true` to `command:` for `mariadb` in you `docker-compose.yaml` file.</>
</p>
:::info[Example]
command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW --log_bin_trust_function_creators=true
:::
```yaml
  mariadb:
    image: mariadb:10.11
    container_name: mariadb
    restart: always
    expose:
      - 3306
    command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW --log_bin_trust_function_creators=true
    volumes:
      - ./mariadb:/var/lib/mysql
    env_file:
      - .mariadb.env
```
<p>
<>Now run the Following Commands</>
</p>
```bash
sudo docker compose down && sudo docker compose up -d
```
<p>
<>Wait for everything to start back up</>
</p>
```bash
sudo docker exec -it -u 33 nextcloud php occ maintenance:repair
sudo docker restart nextcloud
```

### **Image Previews Show Incorrect Images**

<p>
<>When image previews display one image but downloading and viewing shows a different image, this indicates corrupted preview cache. Follow these steps to fix the issue:</>
</p>

**Step 1: Verify the directory structure**
```bash
ls /etc/docker/nextcloud/nextcloud/data
```
<p>
<>You should see `appdata_<instanceid>` in the output. Note: Your Nextcloud path may differ (commonly `/var/docker/nextcloud/nextcloud/data`). Adjust the path according to your setup.</>
</p>

<p>
<>To identify the instance ID more easily, you can also run:</>
</p>
```bash
ls -d /etc/docker/nextcloud/nextcloud/data/appdata_*
```

**Step 2: Navigate to the appdata directory**
```bash
cd /etc/docker/nextcloud/nextcloud/data/appdata_<instanceid>
```
<p>
<>Replace `<instanceid>` with the actual instance ID you saw in Step 1.</>
</p>

**Step 3: Verify location and remove the corrupted preview directory**
```bash
pwd
ls -d preview
```
<p>
<>Confirm you're in the correct appdata directory and that the preview directory exists.</>
</p>

:::caution[Destructive Operation]
The following command will permanently delete the preview cache. Make sure you're in the correct directory before proceeding.
:::

```bash
sudo rm -rf ./preview
```

**Step 4: Regenerate all previews**
```bash
sudo docker exec -it -u 33 nextcloud php occ preview:generate-all
```
<p>
<>Change `nextcloud` to your actual container name if different. Once completed, it will still take some time for previews to populate on the web interface.</>
</p>

:::info[Preview Generator App Required]
The `preview:generate-all` command requires the Preview Generator app. If the command fails with "command not found", install and enable the app:
```bash
sudo docker exec -it -u 33 nextcloud php occ app:install previewgenerator
sudo docker exec -it -u 33 nextcloud php occ app:enable previewgenerator
```
Then retry the preview generation command.
:::

## **Resources**
[Geometry Table](https://memories.gallery/troubleshooting/#trigger-compatibility-mode)


<BuyMeACoffeeButton />
