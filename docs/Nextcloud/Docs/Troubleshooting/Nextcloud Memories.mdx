---
title: Nextcloud Memories
sidebar_position: 2
tags:
   - Docker
   - Nextcloud
   - Tutorial
   - Troubleshooting
keywords: [Docker, Docker Engine, Tutorial, Nextcloud, Troubleshootiing]
last_update:
  author: BankaiTech
---
import BuyMeACoffeeButton from '@site/src/components/BuyMeACoffeeButton';

## Troubleshooting for Nextcloud Memories

### Geometry table has not been created

![Geometry Table](/img/nextcloud/Troubleshooting/GeoTable.jpg)
<p>
<>Run the following command.</>
</p>
```bash
sudo docker exec -it -u 33 nextcloud php occ memories:places-setup
```

### ***Database triggers are not set up correctly.***

<p>
<>You need to add `--log_bin_trust_function_creators=true` to `command:` for `mariadb` in you `docker-compose.yaml` file.</>
</p>
:::info[Example]
command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW --log_bin_trust_function_creators=true
:::
```yaml
  mariadb:
    image: mariadb:10.11
    container_name: mariadb
    restart: always
    expose:
      - 3306
    command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW --log_bin_trust_function_creators=true
    volumes:
      - ./mariadb:/var/lib/mysql
    env_file:
      - .mariadb.env
```
<p>
<>Now run the Following Commands</>
</p>
```bash
sudo docker compose down && sudo docker compose up -d
```
<p>
<>Wait for everything to start back up</>
</p>
```bash
sudo docker exec -it -u 33 nextcloud php occ maintenance:repair
sudo docker restart nextcloud
```

### **Image Previews Show Incorrect Images**

<p>
<>When image previews display one image but downloading and viewing shows a different image, this indicates corrupted preview cache. Follow these steps to fix the issue:</>
</p>

**Step 1: Verify the directory structure**
```bash
ls /etc/docker/nextcloud/nextcloud/data
```
<p>
<>You should see `appdata_<instanceid>` in the output.</>
</p>

**Step 2: Navigate to the appdata directory**
```bash
cd /etc/docker/nextcloud/nextcloud/data/appdata*
```

**Step 3: Remove the corrupted preview directory**
```bash
sudo rm -rf preview
```

**Step 4: Regenerate all previews**
```bash
sudo docker exec -it -u 33 nextcloud php occ preview:generate-all
```
<p>
<>Change `nextcloud` to your actual container name if different. Once completed, it will still take some time for previews to populate on the web interface.</>
</p>

## **Resources**
[Geometry Table](https://memories.gallery/troubleshooting/#trigger-compatibility-mode)


<BuyMeACoffeeButton />
