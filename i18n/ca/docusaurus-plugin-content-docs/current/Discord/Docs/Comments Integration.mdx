---
title: IntegraciÃ³ de comentaris
description: Guia completa per integrar comentaris bidireccionals de Discord amb Docusaurus, incloent-hi la configuraciÃ³ i la resoluciÃ³ de problemes.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# IntegraciÃ³ de comentaris de Discord

Aquest lloc de documentaciÃ³ inclou una **integraciÃ³ de comentaris bidireccionals de Discord** que permet als visitants enviar comentaris al vostre servidor Discord I mostrar les respostes de Discord al lloc web juntament amb els comentaris de Giscus basats en GitHub existents.

## CaracterÃ­stiques

* **ComunicaciÃ³ bidireccional**: Comentaris del lloc web â†’ Discord, respostes de Discord â†’ Lloc web
* **Sistema de comentaris duals**: Els comentaris de Giscus (basat en GitHub) i Discord funcionen conjuntament.
* **Incrustacions enriquides de Discord**: els comentaris apareixen com a incrustacions formatades amb context de pÃ gina completa
* **GestiÃ³ de fils**: CreaciÃ³ automÃ tica de fils per a respostes organitzades
* **Actualitzacions en temps real**: El lloc web mostra les respostes de Discord automÃ ticament
* **Context de pÃ gina completa**: els comentaris inclouen el tÃ­tol de la pÃ gina, l'URL i el context de navegaciÃ³
* **Avatars d'usuari**: Les respostes de Discord mostren els avatars i els noms d'usuari dels usuaris
* **Disseny responsiu**: Funciona tant en ordinadors d'escriptori com en dispositius mÃ²bils

## Instruccions de configuraciÃ³

### 1. Crea un bot de Discord

1. Ves al [Portal de desenvolupadors de Discord](https://discord.com/developers/applications)
2. Crea una nova aplicaciÃ³
3. Ves a la secciÃ³ "Bot" i crea un bot
4. Copia el testimoni del bot
5. A "Intencions de passarelÂ·la privilegiada", activeu:
   * **IntenciÃ³ del contingut del missatge**
   * **IntenciÃ³ dels membres del servidor** (opcional)

### 2) Configura els permisos del bot

El vostre bot necessita aquests permisos:

* Llegir missatges
* Enviar missatges
* Crea fils pÃºblics
* Enviar missatges en fils de discussiÃ³
* Llegeix l'historial de missatges
* Utilitzeu ordres de barra inclinada (opcional)

### 3. Convida el bot al servidor

1. Aneu a OAuth2 > Generador d'URL
2. Selecciona l'Ã mbit "bot"
3. Seleccioneu els permisos que figuren a dalt
4. Utilitzeu l'URL generada per convidar el bot al vostre servidor

### 4) Configura les variables d'entorn

#### Frontend (.env)

```env
# ConfiguraciÃ³ del bot de Discord
DISCORD_BOT_TOKEN=el_teu_token_del_vostre_bot_aquÃ­
DISCORD_CHANNEL_ID=el_teu_id_del_vostre_canal_aquÃ­

# ConfiguraciÃ³ de l'API
REACT_APP_API_URL=http://localhost:3001

# ConfiguraciÃ³ del context de Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Nom del vostre lloc
```

#### Servidor de backend (server/.env)

```env
# ConfiguraciÃ³ del bot de Discord
DISCORD_BOT_TOKEN=el_teu_token_del_vostre_bot_aquÃ­
DISCORD_CHANNEL_ID=el_teu_id_del_vostre_canal_aquÃ­

# ConfiguraciÃ³ de l'API
PORT=3001

# ConfiguraciÃ³ del context de Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Nom del vostre lloc web
```

:::avÃ­s Nota de seguretat

* No commit mai els fitxers `.env` al control de versions
* Utilitzar variables d'entorn en producciÃ³
* Mantingueu el testimoni del vostre bot segur
  :::

### 5. InstalÂ·lar dependÃ¨ncies del servidor

```bash
instalÂ·laciÃ³ npm del servidor cd

```

### 6. Inicia el servidor backend

```bash
# Desenvolupament
npm run dev

# ProducciÃ³
npm start
```

### 7. Implementa la configuraciÃ³

Per a implementacions de producciÃ³, definiu variables d'entorn a la vostra plataforma d'allotjament:

* **Frontend**: Estableix `REACT_APP_API_URL` com a URL de l'API de producciÃ³
* **Backend**: Implementa la carpeta del servidor amb el testimoni del bot i l'ID del canal
* **Base de dades**: la base de dades SQLite es crearÃ  automÃ ticament
* **Context**: Configura el nivell de context i les opcions de Discord segons les teves preferÃ¨ncies

## Com funciona

### Flux bidireccional complet

1. **Comentari del lloc web**: L'usuari envia un comentari a travÃ©s del formulari del lloc web
2. **Missatge de Discord**: El bot envia un incrustat formatat al canal de Discord amb el context de la pÃ gina completa
3. **CreaciÃ³ de fils**: El bot crea automÃ ticament un fil per a respostes organitzades.
4. **Respostes de Discord**: Els usuaris de Discord responen al fil o al missatge
5. **Emmagatzematge de base de dades**: El bot emmagatzema tots els comentaris i respostes a la base de dades SQLite
6. **VisualitzaciÃ³ del lloc web**: El frontend sondeja l'API cada 30 segons i mostra les respostes de Discord

### Format de missatge de Discord

Les insercions de Discord inclouen:

* **Title**: "ğŸ’¬ New Comment: \{Page Title}"
* **DescripciÃ³**: El contingut real del comentari
* **Autor**: Nom del comentarista
* **URL**: EnllaÃ§ clicable a la pÃ gina exacta
* **Camp de pÃ gina**: Mostra el tÃ­tol de la pÃ gina amb un enllaÃ§ en quÃ¨ es pot fer clic
* **Marca de temps**: Quan es va publicar el comentari
* **Fil**: Fil creat automÃ ticament per a respostes

### VisualitzaciÃ³ del lloc web

El lloc web mostra:

* **Comentaris originals**: Enviaments de formularis de lloc web
* **Respostes de Discord**: Respostes d'usuaris de Discord amb avatars i noms d'usuari
* **Actualitzacions en temps real**: Sondeig automÃ tic per a noves respostes
* **Converses en fils**: Comentari organitzat â†’ estructura de resposta

## ConfiguraciÃ³ del context

### Nivells de context

Configura quant context apareix als missatges de Discord:

#### `DISCORD_CONTEXT_LEVEL=mÃ­nim`

* **Programes**: NomÃ©s el tÃ­tol de la pÃ gina i el contingut dels comentaris
* **Cas d'Ãºs**: Missatges nets i senzills sense context addicional

#### `DISCORD_CONTEXT_LEVEL=bÃ sic`

* **Mostra**: TÃ­tol de la pÃ gina, contingut dels comentaris i URL de la pÃ gina en quÃ¨ es pot fer clic
* **Cas d'Ãºs**: Context moderat amb informaciÃ³ essencial

#### `DISCORD_CONTEXT_LEVEL=full` (per defecte)

* **Mostra**: Tota la informaciÃ³ de context, incloent-hi les rutes de navegaciÃ³, les seccions i les marques de temps
* **Cas d'Ãºs**: Context mÃ xim per a debats detallats

#### `DISCORD_CONTEXT_LEVEL=personalitzat`

* **Mostra**: NomÃ©s els elements de context que activeu individualment
* **Cas d'Ãºs**: Control precÃ­s sobre el que apareix

### Controls de context individuals

Quan feu servir `DISCORD_CONTEXT_LEVEL=custom`, podeu controlar cada element:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Mostra el tÃ­tol de la pÃ gina i el camp d'URL
DISCORD_SHOW_BREADCRUMBS=true # Mostra les rutes de navegaciÃ³
DISCORD_SHOW_SECTION_INFO=true # Mostra la secciÃ³ principal (Docker, Nextcloud, etc.)
DISCORD_SHOW_PAGE_PATH=false # Mostra la ruta completa de l'URL
DISCORD_SHOW_TIMESTAMP=true # Mostra quan es va publicar el comentari
DISCORD_SHOW_AUTHOR_FIELD=true # Mostra el nom del comentarista com a autor incrustat
```

### ConfiguraciÃ³ del fil

```env
DISCORD_CREATE_THREADS=true # Crea fils per a respostes
DISCORD_THREAD_DURATION=1440 # Temps d'arxivament automÃ tic del fil (minuts)
DISCORD_SITE_NAME=Nom del vostre lloc # Nom del lloc al peu de pÃ gina
```

### Exemple de sortides de context

**Context mÃ­nim:**

```
Guia d'instalÂ·laciÃ³ de Docker
"Aquest tutorial ha estat molt Ãºtil! Com puc gestionar els conflictes de ports?"
```

**Context bÃ sic:**

```
ğŸ’¬ Guia d'instalÂ·laciÃ³ de Docker
"Aquest tutorial ha estat molt Ãºtil! Com puc gestionar els conflictes de ports?"
[EnllaÃ§ a la pÃ gina]
```

**Context complet:**

```
ğŸ’¬ Nou comentari: Guia d'instalÂ·laciÃ³ de Docker
ğŸ‘¤ John Doe
"Aquest tutorial ha estat molt Ãºtil! Com puc gestionar els conflictes de ports?"

ğŸ“„ PÃ gina: Guia d'instalÂ·laciÃ³ de Docker
ğŸ“ NavegaciÃ³: Docker > DocumentaciÃ³ > InstalÂ·laciÃ³ de Docker
ğŸ“‚ SecciÃ³: Docker
ğŸ”— Ruta: /Docker/Docs/Installing%20Docker/Docker%20Eengine

Nom del vostre lloc â€¢ Sistema de comentaris
```

## PersonalitzaciÃ³

### Estilisme

El component de comentaris de Discord utilitza mÃ²duls CSS. Podeu personalitzar l'aspecte modificant:

```
src/components/DiscordComments/styles.module.css
```

### Format del missatge

Per personalitzar el format d'incrustaciÃ³ de Discord, editeu l'objecte `discordMessage` a:

```
src/components/DiscordComments/index.tsx
```

### ColÂ·locaciÃ³ de components

Els comentaris de Discord apareixen per defecte a sota dels comentaris de Giscus. Per canviar aixÃ², modifiqueu:

```
src/theme/DocItem/Layout/index.js
```

## ResoluciÃ³ de problemes

### El bot no respon

1. **Comprova el token del bot**: Assegura't que `DISCORD_BOT_TOKEN` sigui correcte
2. **Verifica els permisos**: Assegura't que el bot tingui els permisos necessaris al canal.
3. **Comprova l'ID del canal**: Assegura't que `DISCORD_CHANNEL_ID` sigui correcte
4. **Bot al servidor**: Verifiqueu que el bot realment Ã©s al vostre servidor de Discord.

### Els comentaris no apareixen

1. **Servidor en execuciÃ³**: Comproveu si el servidor backend s'executa al port correcte
2. **URL de l'API**: Verifiqueu que `REACT_APP_API_URL` apunti al vostre servidor backend.
3. **Base de dades**: Comprova si la base de dades SQLite s'estÃ  creant a la carpeta del servidor
4. **CORS**: Assegureu-vos que CORS estigui configurat per al vostre domini frontend.

### No es mostren les respostes de Discord

1. **IntenciÃ³ del contingut del missatge**: assegureu-vos que aixÃ² estigui habilitat al portal per a desenvolupadors de Discord
2. **Permisos del bot**: Verifica que el bot pot llegir els missatges del canal
3. **ConnexiÃ³ a la base de dades**: Comproveu els registres del servidor per detectar errors de la base de dades
4. **Enquesta**: El frontend envia enquestes cada 30 segons; les respostes poden trigar a aparÃ¨ixer.

### Les variables d'entorn no funcionen

* **Desenvolupament**: Reinicieu els servidors frontend i backend
* **ProducciÃ³**: RedistribuÃ¯u tant el frontend com el backend amb les variables d'entorn correctes
* **Prefix**: Utilitzeu el prefix `REACT_APP_` nomÃ©s per a variables de frontend

### Problemes de base de dades

1. **Permisos de fitxer**: Assegureu-vos que el servidor pugui escriure al directori de la base de dades
2. **Espai de disc**: Comproveu l'espai de disc disponible per a la base de dades SQLite
3. **Registres del servidor**: Comproveu si hi ha errors de connexiÃ³ a la base de dades a la consola del servidor

## Consideracions de seguretat

* **Token del bot**: Mantingueu el token del bot en secret i no el commiteixi mai al control de versions
* **LimitaciÃ³ de velocitat**: Discord tÃ© lÃ­mits de velocitat per als bots (diferents dels webhooks)
* **ValidaciÃ³ d'entrada**: Tant el frontend com el backend validen l'entrada de l'usuari
* **Seguretat de la base de dades**: la base de dades SQLite ha d'estar protegida amb els permisos de fitxer adequats.
* **Seguretat de l'API**: Penseu en implementar una limitaciÃ³ de velocitat als punts finals de l'API.
* **CORS**: Configureu CORS correctament per al vostre domini de producciÃ³

## Arquitectura

```
Frontend del lloc web â†â†’ API Express â†â†’ Bot de Discord â†â†’ Servidor de Discord
                    â†“
                Base de dades SQLite
```

## Estructura de fitxers

```
project/
â”œâ”€â”€ src/components/DiscordComments/ # Component frontend
â”œâ”€â”€ server/ # Servidor backend
â”‚ â”œâ”€â”€ api.js # Servidor API Express
â”‚ â”œâ”€â”€ discord-bot.js # LÃ²gica del bot Discord
â”‚ â”œâ”€â”€ database.js # Funcions de base de dades SQLite
â”‚ â””â”€â”€ package.json # DependÃ¨ncies del servidor
â””â”€â”€ docs/Discord/Docs/ # DocumentaciÃ³
```

## Suport del navegador

El component de comentaris de Discord funciona en tots els navegadors moderns que admeten:

* API de recuperaciÃ³ d'ES6
* Reacciona 18+
* CSS Grid i Flexbox
* Emmagatzematge local (per a la persistÃ¨ncia de formularis)
