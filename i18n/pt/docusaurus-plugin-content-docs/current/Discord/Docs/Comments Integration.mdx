---
title: Integra√ß√£o de coment√°rios
description: Guia completo para integrar coment√°rios bidirecionais do Discord com o Docusaurus, incluindo configura√ß√£o, instala√ß√£o e solu√ß√£o de problemas.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# Integra√ß√£o de coment√°rios do Discord

Este site de documenta√ß√£o inclui uma **integra√ß√£o bidirecional de coment√°rios do Discord** que permite aos visitantes enviar coment√°rios para o seu servidor do Discord E exibir as respostas do Discord de volta no site, juntamente com os coment√°rios existentes do Giscus baseado no GitHub.

## Caracter√≠sticas

- **Comunica√ß√£o bidirecional**: Coment√°rios no site ‚Üí Discord, respostas do Discord ‚Üí Site
- **Sistema de coment√°rios duplo**: Os coment√°rios do Giscus (baseado no GitHub) e do Discord funcionam em conjunto.
- **Incorpora√ß√µes avan√ßadas do Discord**: Os coment√°rios aparecem como incorpora√ß√µes formatadas com contexto de p√°gina inteira.
- **Gerenciamento de t√≥picos**: Cria√ß√£o autom√°tica de t√≥picos para respostas organizadas.
- **Atualiza√ß√µes em tempo real**: O site exibe automaticamente as respostas do Discord.
- **Contexto completo da p√°gina**: Os coment√°rios incluem o t√≠tulo da p√°gina, o URL e o contexto de navega√ß√£o.
- **Avatares de Usu√°rio**: As respostas do Discord exibem avatares e nomes de usu√°rio.
- **Design responsivo**: Funciona tanto em computadores quanto em dispositivos m√≥veis.

## Instru√ß√µes de instala√ß√£o

### 1. Crie um bot para o Discord

1. Acesse o [Portal do Desenvolvedor do Discord](https://discord.com/developers/applications)
2. Criar um novo aplicativo
3. Acesse a se√ß√£o "Bot" e crie um bot.
4. Copie o token do bot
5. Em "Inten√ß√µes de Gateway Privilegiado", habilite:
   - **Inten√ß√£o do conte√∫do da mensagem**
   - **Inten√ß√£o dos membros do servidor** (opcional)

### 7. Configura√ß√£o de Implanta√ß√£o

Seu bot precisa destas permiss√µes:

- Ler mensagens
- Enviar mensagens
- Criar t√≥picos p√∫blicos
- Enviar mensagens em t√≥picos
- Leia o hist√≥rico de mensagens
- Usar comandos de barra (opcional)

### 6. Start the Backend Server

1. Acesse OAuth2 > Gerador de URL
2. Selecione o escopo "bot"
3. Selecione as permiss√µes listadas acima.
4. Utilize o URL gerado para convidar o bot para o seu servidor.

### 5. Instalar depend√™ncias do servidor

#### Frontend (.env)

```env
# Configura√ß√£o do Bot do Discord
DISCORD_BOT_TOKEN=seu_token_do_bot_aqui
DISCORD_CHANNEL_ID=seu_id_do_canal_aqui

# Configura√ß√£o da API
REACT_APP_API_URL=http://localhost:3001

# Configura√ß√£o do Contexto do Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Nome do seu site
```

#### Servidor de backend (servidor/.env)

```env
# Configura√ß√£o do Bot do Discord
DISCORD_BOT_TOKEN=seu_token_do_bot_aqui
DISCORD_CHANNEL_ID=seu_id_do_canal_aqui

# Configura√ß√£o da API
PORT=3001

# Configura√ß√£o do Contexto do Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Nome do seu site
```

:::aviso Nota de seguran√ßa

- Nunca inclua arquivos `.env` no controle de vers√£o.
- Utilizar vari√°veis de ambiente em produ√ß√£o
- Mantenha o token do seu bot em seguran√ßa
  :::

### 6. Inicie o servidor de backend.

```bash
cd servidor
npm instalar
```

### 6. Start the Backend Server

```bash
# Desenvolvimento
npm run dev

# Produ√ß√£o
npm start
```

### 7. 7. Deploy Configuration

Para implanta√ß√µes em produ√ß√£o, configure as vari√°veis de ambiente na sua plataforma de hospedagem:

- **Frontend**: Defina `REACT_APP_API_URL` com a URL da sua API de produ√ß√£o.
- **Backend**: Implante a pasta do servidor com o token do bot e o ID do canal.
- **Banco de dados**: Um banco de dados SQLite ser√° criado automaticamente.
- **Contexto**: Configure o n√≠vel de contexto e as op√ß√µes do Discord de acordo com suas prefer√™ncias.

## Como funciona

### Fluxo bidirecional completo

1. **Coment√°rio no site**: O usu√°rio envia um coment√°rio atrav√©s do formul√°rio do site.
2. **Mensagem do Discord**: O bot envia um conte√∫do incorporado formatado para o canal do Discord com o contexto completo da p√°gina.
3. **Cria√ß√£o de T√≥pico**: O bot cria automaticamente um t√≥pico para organizar as respostas.
4. **Respostas do Discord**: Usu√°rios do Discord respondem na thread ou √† mensagem.
5. **Armazenamento de banco de dados**: O bot armazena todos os coment√°rios e respostas em um banco de dados SQLite.
6. **Exibi√ß√£o no site**: O frontend consulta a API a cada 30 segundos e exibe as respostas do Discord.

### Formato de mensagem do Discord

Os recursos integrados do Discord incluem:

- **Title**: "üí¨ New Comment: \{Page Title}"
- **Descri√ß√£o**: O conte√∫do real do coment√°rio
- **Autor**: Nome do comentarista
- **URL**: Link clic√°vel para a p√°gina exata
- **Campo da p√°gina**: Exibe o t√≠tulo da p√°gina com um link clic√°vel.
- **Data e hora**: Quando o coment√°rio foi publicado
- **T√≥pico**: T√≥pico criado automaticamente para respostas

### Exibi√ß√£o do site

O site mostra:

- **Coment√°rios originais**: Envio de formul√°rios do site
- **Respostas do Discord**: Respostas de usu√°rios do Discord com avatares e nomes de usu√°rio.
- **Atualiza√ß√µes em tempo real**: Verifica√ß√£o autom√°tica de novas respostas
- **Conversas em t√≥picos**: Estrutura organizada de coment√°rios ‚Üí respostas

## Configura√ß√£o de contexto

### N√≠veis de contexto

Configure a quantidade de contexto que aparece nas mensagens do Discord:

#### `DISCORD_CONTEXT_LEVEL=minimal`

- **Exibe**: Apenas o t√≠tulo da p√°gina e o conte√∫do dos coment√°rios.
- **Caso de uso**: Mensagens claras e simples, sem contexto adicional.

#### `DISCORD_CONTEXT_LEVEL=basic`

- **Exibe**: T√≠tulo da p√°gina, conte√∫do dos coment√°rios e URL clic√°vel da p√°gina
- **Caso de uso**: Contexto moderado com informa√ß√µes essenciais

#### `DISCORD_CONTEXT_LEVEL=full` (padr√£o)

- **Exibe**: Todas as informa√ß√µes de contexto, incluindo trilhas de navega√ß√£o, se√ß√µes e registros de data e hora.
- **Caso de uso**: Contexto m√°ximo para discuss√µes detalhadas

#### `DISCORD_CONTEXT_LEVEL=custom`

- **Exibe**: Apenas os elementos de contexto que voc√™ habilitar individualmente.
- **Caso de uso**: Controle preciso sobre o que aparece

### Controles de contexto individual

Ao usar `DISCORD_CONTEXT_LEVEL=custom`, voc√™ pode controlar cada elemento:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Exibir o t√≠tulo da p√°gina e o campo URL
DISCORD_SHOW_BREADCRUMBS=true # Exibir o caminho de navega√ß√£o
DISCORD_SHOW_SECTION_INFO=true # Exibir a se√ß√£o principal (Docker, Nextcloud, etc.)
DISCORD_SHOW_PAGE_PATH=false # Exibir o caminho completo da URL
DISCORD_SHOW_TIMESTAMP=true # Exibir a data e hora da publica√ß√£o do coment√°rio
DISCORD_SHOW_AUTHOR_FIELD=true # Exibir o nome do comentarista como autor do conte√∫do incorporado
```

### Configura√ß√£o de threads

```env
DISCORD_CREATE_THREADS=true # Criar t√≥picos para respostas
DISCORD_THREAD_DURATION=1440 # Tempo de arquivamento autom√°tico do t√≥pico (minutos)
DISCORD_SITE_NAME=Nome do seu site # Nome do site no rodap√©
```

### Sa√≠das de contexto de exemplo

**Contexto m√≠nimo:**

```
Guia de Instala√ß√£o do Docker
"Este tutorial foi muito √∫til! Como fa√ßo para lidar com conflitos de porta?"
```

**Contexto b√°sico:**

```
üí¨ Guia de Instala√ß√£o do Docker
"Este tutorial foi muito √∫til! Como fa√ßo para lidar com conflitos de porta?"
[Link para a p√°gina]
```

**Contexto completo:**

```
üí¨ Novo Coment√°rio: Guia de Instala√ß√£o do Docker
üë§ John Doe
"Este tutorial foi muito √∫til! Como fa√ßo para lidar com conflitos de portas?"

üìÑ P√°gina: Guia de Instala√ß√£o do Docker
üìç Navega√ß√£o: Docker > Documenta√ß√£o > Instalando o Docker
üìÇ Se√ß√£o: Docker
üîó Caminho: /Docker/Docs/Installing%20Docker/Docker%20Engin

Nome do seu site ‚Ä¢ Sistema de coment√°rios
```

## Personaliza√ß√£o

### Styling

O componente de coment√°rios do Discord utiliza m√≥dulos CSS. Voc√™ pode personalizar a apar√™ncia modificando:

```
src/components/DiscordComments/styles.module.css
```

### Formato da mensagem

Para personalizar o formato de incorpora√ß√£o do Discord, edite o objeto `discordMessage` em:

```
src/components/DiscordComments/index.tsx
```

### Posicionamento dos componentes

Os coment√°rios do Discord aparecem abaixo dos coment√°rios do Giscus por padr√£o. Para alterar isso, modifique:

```
src/theme/DocItem/Layout/index.js
```

## Solu√ß√£o de problemas

### O bot n√£o est√° respondendo.

1. **Verifique o token do bot**: Certifique-se de que `DISCORD_BOT_TOKEN` esteja correto.
2. **Verificar permiss√µes**: Certifique-se de que o bot tenha as permiss√µes necess√°rias no canal.
3. **Verifique o ID do canal**: Certifique-se de que `DISCORD_CHANNEL_ID` esteja correto.
4. **Bot no servidor**: Verifique se o bot est√° realmente no seu servidor do Discord.

### Coment√°rios n√£o est√£o aparecendo

1. **Servidor em execu√ß√£o**: Verifique se o servidor de backend est√° em execu√ß√£o na porta correta.
2. **URL da API**: Verifique se `REACT_APP_API_URL` aponta para o seu servidor de backend.
3. **Banco de dados**: Verifique se o banco de dados SQLite est√° sendo criado na pasta do servidor.
4. **CORS**: Certifique-se de que o CORS esteja configurado para o seu dom√≠nio de front-end.

### Respostas do Discord n√£o est√£o sendo exibidas

1. **Inten√ß√£o de conte√∫do da mensagem**: Certifique-se de que esta op√ß√£o esteja ativada no Portal do Desenvolvedor do Discord.
2. **Permiss√µes do bot**: Verificar se o bot pode ler mensagens no canal.
3. **Conex√£o com o banco de dados**: Verifique os logs do servidor em busca de erros no banco de dados.
4. **Enquetes**: O frontend realiza enquetes a cada 30 segundos - as respostas podem demorar a aparecer.

### Vari√°veis de ambiente n√£o est√£o funcionando

- **Desenvolvimento**: Reinicie os servidores de front-end e back-end.
- **Produ√ß√£o**: Reimplemente o frontend e o backend com as vari√°veis de ambiente corretas.
- **Prefixo:** Use o prefixo `REACT_APP_` apenas para vari√°veis de front-end.

### Problemas com o banco de dados

1. **Permiss√µes de arquivo**: Certifique-se de que o servidor possa gravar no diret√≥rio do banco de dados.
2. **Espa√ßo em disco**: Verifique o espa√ßo em disco dispon√≠vel para o banco de dados SQLite.
3. **Logs do servidor**: Verifique o console do servidor em busca de erros de conex√£o com o banco de dados.

## Considera√ß√µes de seguran√ßa

- **Token do Bot**: Mantenha o token do seu bot em segredo e nunca o inclua no controle de vers√£o.
- **Limita√ß√£o de taxa**: O Discord possui limites de taxa para bots (diferentes dos webhooks).
- **Valida√ß√£o de entrada**: Tanto o frontend quanto o backend validam a entrada do usu√°rio.
- **Seguran√ßa do banco de dados**: O banco de dados SQLite deve ser protegido com permiss√µes de arquivo adequadas.
- **Seguran√ßa da API**: Considere implementar limita√ß√£o de taxa nos seus endpoints de API.
- **CORS**: Configure o CORS corretamente para o seu dom√≠nio de produ√ß√£o.

## Arquitetura

```
Frontend do site ‚Üê‚Üí API Express ‚Üê‚Üí Bot do Discord ‚Üê‚Üí Servidor do Discord
                    ‚Üì
                Banco de dados SQLite
```

## Estrutura de Arquivos

```
projeto/
‚îú‚îÄ‚îÄ src/components/DiscordComments/ # Componente de front-end
‚îú‚îÄ‚îÄ server/ # Servidor de back-end
‚îÇ ‚îú‚îÄ‚îÄ api.js # Servidor de API Express
‚îÇ ‚îú‚îÄ‚îÄ discord-bot.js # L√≥gica do bot do Discord
‚îÇ ‚îú‚îÄ‚îÄ database.js # Fun√ß√µes do banco de dados SQLite
‚îÇ ‚îî‚îÄ‚îÄ package.json # Depend√™ncias do servidor
‚îî‚îÄ‚îÄ docs/Discord/Docs/ # Documenta√ß√£o
```

## Suporte do navegador

O componente de coment√°rios do Discord funciona em todos os navegadores modernos que suportam:

- API fetch do ES6
- React 18+
- CSS Grid e Flexbox
- Armazenamento local (para persist√™ncia de formul√°rios)
