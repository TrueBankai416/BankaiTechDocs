---
title: Kommentarintegration
description: Komplet guide til integration af bidirektionelle Discord-kommentarer med Docusaurus, inklusive opsÃ¦tning, konfiguration og fejlfinding.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# Integration af Discord-kommentarer

Denne dokumentationsside inkluderer en **bidirektionel Discord-kommentarintegration**, der giver besÃ¸gende mulighed for at sende kommentarer til din Discord-server OG vise Discord-svar tilbage pÃ¥ hjemmesiden sammen med de eksisterende GitHub-baserede Giscus-kommentarer.

## Funktioner

- **Tovejskommunikation**: Kommentarer til hjemmesiden â†’ Discord, Discord-svar â†’ Hjemmeside
- **Dobbelt kommentarsystem**: BÃ¥de Giscus (GitHub-baseret) og Discord-kommentarer fungerer sammen.
- **Rige Discord-indlejringer**: Kommentarer vises som formaterede indlejringer med fuld sidekontekst
- **TrÃ¥dhÃ¥ndtering**: Automatisk trÃ¥doprettelse til organiserede svar
- **Opdateringer i realtid**: Hjemmesiden viser automatisk Discord-svar
- **Fuld sidekontekst**: Kommentarer inkluderer sidetitel, URL og navigationskontekst
- **Brugeravatarer**: Discord-svar viser brugeravatarer og brugernavne
- **Responsivt design**: Fungerer pÃ¥ bÃ¥de desktop- og mobilenheder

## OpsÃ¦tningsvejledning

### 1. Create a Discord Bot

1. GÃ¥ til [Discord Udviklerportal](https://discord.com/developers/applications)
2. Opret en ny applikation
3. GÃ¥ til sektionen "Bot" og opret en bot
4. KopiÃ©r bot-tokenet
5. Under "Privilegerede gateway-intentioner" skal du aktivere:
   - **Intention for beskedindhold**
   - **Servermedlemmers intention** (valgfrit)

### 2. Configure Bot Permissions

Din bot skal bruge disse tilladelser:

- LÃ¦s beskeder
- Send beskeder
- Opret offentlige trÃ¥de
- Send beskeder i trÃ¥de
- LÃ¦s beskedhistorik
- Brug skrÃ¥stregkommandoer (valgfrit)

### 3. Invite Bot to Server

1. GÃ¥ til OAuth2 > URL-generator
2. VÃ¦lg "bot"-omrÃ¥det
3. VÃ¦lg de tilladelser, der er angivet ovenfor
4. Brug den genererede URL til at invitere botten til din server

### 4. Configure Environment Variables

#### Frontend (.env)

```env
# Discord Bot-konfiguration
DISCORD_BOT_TOKEN=din_bot_token_her
DISCORD_CHANNEL_ID=din_kanal_id_her

# API-konfiguration
REACT_APP_API_URL=http://localhost:3001

# Discord-kontekstkonfiguration
DISCORD_CONTEXT_LEVEL=fuld
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Dit webstedsnavn
```

#### Backend-server (server/.env)

```env
# Discord Bot-konfiguration
DISCORD_BOT_TOKEN=din_bot_token_her
DISCORD_CHANNEL_ID=din_kanal_id_her

# API-konfiguration
PORT=3001

# Discord-kontekstkonfiguration
DISCORD_CONTEXT_LEVEL=fuld
DISCORD_SHOW_PAGE_CONTEXT=sand
DISCORD_SHOW_BREADCRUMBS=sand
DISCORD_SHOW_SECTION_INFO=sand
DISCORD_SHOW_PAGE_PATH=falsk
DISCORD_SHOW_TIMESTAMP=sand
DISCORD_SHOW_AUTHOR_FIELD=sand
DISCORD_CREATE_THREADS=sand
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Dit webstedsnavn
```

:::advarsel SikkerhedsbemÃ¦rkning

- Commit aldrig `.env`-filer til versionskontrol
- Brug miljÃ¸variabler i produktion
- Hold din bot-token sikker
  :::

### 5. Install Server Dependencies

```bash
cd-server
npm-installation
```

### 6. Start the Backend Server

```bash
# Udvikling
npm run dev

# Produktion
npm start
```

### 7. Deploy Configuration

For produktionsinstallationer skal du angive miljÃ¸variabler i din hostingplatform:

- **Frontend**: Indstil `REACT_APP_API_URL` til din produktions-API-URL
- **Backend**: Implementer servermappen med bot-token og kanal-ID
- **Database**: SQLite-databasen oprettes automatisk
- **Kontekst**: Konfigurer Discord-kontekstniveau og -indstillinger efter dine prÃ¦ferencer

## SÃ¥dan fungerer det

### Komplet tovejsstrÃ¸m

1. **Kommentar til hjemmeside**: Brugeren sender en kommentar via en hjemmesideformular
2. **Discord-besked**: Bot sender formateret embed til Discord-kanal med fuld sidekontekst
3. **Oprettelse af trÃ¥d**: Bot opretter automatisk en trÃ¥d til organiserede svar
4. **Discord-svar**: Discord-brugere svarer i trÃ¥den eller pÃ¥ beskeden
5. **Databaselagring**: Botten gemmer alle kommentarer og svar i SQLite-databasen
6. **Website Display**: Frontend polls API every 30 seconds and displays Discord replies

### Discord-beskedformat

Discord-indlejringer inkluderer:

- **Title**: "ğŸ’¬ New Comment: \{Page Title}"
- **Beskrivelse**: Det faktiske indhold af kommentaren
- **Forfatter**: Navn pÃ¥ kommentator
- **URL**: Klikbart link til den nÃ¸jagtige side
- **Sidefelt**: Viser sidetitel med klikbart link
- **Tidsstempel**: HvornÃ¥r kommentaren blev postet
- **TrÃ¥d**: Automatisk oprettet trÃ¥d til svar

### Webstedsvisning

Hjemmesiden viser:

- **Oprindelige kommentarer**: Indsendelse af hjemmesideformularer
- **Discord-svar**: Svar fra Discord-brugere med avatarer og brugernavne
- **Opdateringer i realtid**: Automatisk afstemning for nye svar
- **TrÃ¥dede samtaler**: Organiseret kommentar â†’ svarstruktur

## Kontekstkonfiguration

### Kontekstniveauer

Konfigurer hvor meget kontekst der vises i Discord-beskeder:

#### `DISCORD_CONTEXT_LEVEL=minimal`

- **Viser**: Kun sidetitel og kommentarindhold
- **Brugseksempel**: Rene, enkle beskeder uden ekstra kontekst

#### `DISCORD_CONTEXT_LEVEL=grundlÃ¦ggende`

- **Viser**: Sidetitel, kommentarindhold og klikbar side-URL
- **Brugsscenarie**: Moderat kontekst med vigtige oplysninger

#### `DISCORD_CONTEXT_LEVEL=fuld` (standard)

- **Viser**: Alle kontekstoplysninger inklusive brÃ¸dkrummer, sektioner, tidsstempler
- **Brugsscenarie**: Maksimal kontekst til detaljerede diskussioner

#### `DISCORD_CONTEXT_LEVEL=brugerdefineret`

- **Viser**: Kun de kontekstelementer, du aktiverer individuelt
- **Brugsscenario**: Finjusteret kontrol over, hvad der vises

### Individuelle kontekstkontroller

NÃ¥r du bruger `DISCORD_CONTEXT_LEVEL=custom`, kan du styre hvert element:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Vis sidetitel og URL-felt
DISCORD_SHOW_BREADCRUMBS=true # Vis navigationsbrÃ¸dkrummer
DISCORD_SHOW_SECTION_INFO=true # Vis hovedsektion (Docker, Nextcloud osv.)
DISCORD_SHOW_PAGE_PATH=false # Vis fuld URL-sti
DISCORD_SHOW_TIMESTAMP=true # Vis, hvornÃ¥r kommentaren blev postet
DISCORD_SHOW_AUTHOR_FIELD=true # Vis kommentatornavn som indlejret forfatter
```

### TrÃ¥dkonfiguration

```env
DISCORD_CREATE_THREADS=true # Opret trÃ¥de til svar
DISCORD_THREAD_DURATION=1440 # Tid for automatisk arkivering af trÃ¥d (minutter)
DISCORD_SITE_NAME=Dit webstedsnavn # Webstedsnavn i sidefoden
```

### Eksempel pÃ¥ kontekstoutput

**Minimal kontekst:**

```
Docker-installationsvejledning
"Denne vejledning var virkelig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"
```

**GrundlÃ¦ggende kontekst:**

```
ğŸ’¬ Docker installationsvejledning
"Denne vejledning var virkelig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"
[Link til side]
```

**Fuld kontekst:**

```
ğŸ’¬ Ny kommentar: Docker installationsvejledning
ğŸ‘¤ John Doe
"Denne vejledning var virkelig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"

ğŸ“„ Side: Docker installationsvejledning
ğŸ“ Navigation: Docker > Dokumenter > Installation af Docker
ğŸ“‚ Sektion: Docker
ğŸ”— Sti: /Docker/Dokumenter/Installation%20Docker/Docker%20Eengine

Dit webstedsnavn â€¢ Kommentarsystem
```

## Tilpasning

### Styling

The Discord comments component uses CSS modules. You can customize the appearance by modifying:

```
src/komponenter/Discordkommentarer/stilarter.modul.css
```

### Meddelelsesformat

For at tilpasse Discord-embed-formatet skal du redigere `discordMessage`-objektet i:

```
src/komponenter/Discordkommentarer/indeks.tsx
```

### Komponentplacering

The Discord comments appear below the Giscus comments by default. To change this, modify:

```
src/tema/DocItem/Layout/index.js
```

## Fejlfinding

### Botten svarer ikke

1. **Tjek bot-token**: SÃ¸rg for, at `DISCORD_BOT_TOKEN` er korrekt
2. **BekrÃ¦ft tilladelser**: SÃ¸rg for, at botten har de nÃ¸dvendige tilladelser i kanalen
3. **Tjek kanal-ID**: SÃ¸rg for, at `DISCORD_CHANNEL_ID` er korrekt
4. **Bot pÃ¥ server**: BekrÃ¦ft at botten rent faktisk er pÃ¥ din Discord-server

### Kommentarer vises ikke

1. **Server kÃ¸rer**: Kontroller om backend-serveren kÃ¸rer pÃ¥ den korrekte port
2. **API URL**: BekrÃ¦ft at `REACT_APP_API_URL` peger pÃ¥ din backend-server
3. **Database**: Kontroller, om SQLite-databasen oprettes i servermappen
4. **CORS**: SÃ¸rg for, at CORS er konfigureret til dit frontend-domÃ¦ne

### Discord-svar vises ikke

1. **BeskedindholdsformÃ¥l**: SÃ¸rg for, at dette er aktiveret i Discord Developer Portal
2. **Bottilladelser**: BekrÃ¦ft, at botten kan lÃ¦se beskeder i kanalen
3. **Databaseforbindelse**: Tjek serverlogfiler for databasefejl
4. **Polling**: Frontend polls every 30 seconds - replies may take time to appear

### MiljÃ¸variabler virker ikke

- **Udvikling**: Genstart bÃ¥de frontend- og backend-servere
- **Produktion**: Omimplementer bÃ¥de frontend og backend med korrekte miljÃ¸variabler
- **PrÃ¦fiks**: Brug kun prÃ¦fikset `REACT_APP_` til frontend-variabler

### Databaseproblemer

1. **Filtilladelser**: SÃ¸rg for, at serveren kan skrive til databasemappen
2. **Diskplads**: Tjek ledig diskplads til SQLite-databasen
3. **Serverlogfiler**: Kontroller serverkonsollen for databaseforbindelsesfejl

## Sikkerhedsovervejelser

- **Bot-token**: Hold din bot-token hemmelig, og overfÃ¸r den aldrig til versionskontrol.
- **HastighedsbegrÃ¦nsning**: Discord har hastighedsgrÃ¦nser for bots (forskellige fra webhooks)
- **Inputvalidering**: BÃ¥de frontend og backend validerer brugerinput
- **Databasesikkerhed**: SQLite-databasen skal beskyttes med de korrekte filtilladelser
- **API-sikkerhed**: Overvej at implementere hastighedsbegrÃ¦nsning pÃ¥ dine API-slutpunkter
- **CORS**: Konfigurer CORS korrekt til dit produktionsdomÃ¦ne

## Arkitektur

```
Hjemmeside-frontend â†â†’ Express API â†â†’ Discord Bot â†â†’ Discord-server
                    â†“
                SQLite-database
```

## Filstruktur

```
projekt/
â”œâ”€â”€ src/komponenter/Discordkommentarer/ # Frontend-komponent
â”œâ”€â”€ server/ # Backend-server
â”‚ â”œâ”€â”€ api.js # Express API-server
â”‚ â”œâ”€â”€ discord-bot.js # Discord bot-logik
â”‚ â”œâ”€â”€ database.js # SQLite-databasefunktioner
â”‚ â””â”€â”€ package.json # ServerafhÃ¦ngigheder
â””â”€â”€ docs/Discord/Dokumenter/ # Dokumentation
```

## BrowserunderstÃ¸ttelse

Discord-kommentarkomponenten fungerer i alle moderne browsere, der understÃ¸tter:

- ES6 hent API
- Reager 18+
- CSS Grid og Flexbox
- Lokal lagring (til formularpersistens)
