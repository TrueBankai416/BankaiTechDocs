---
title: Kommentarintegration
description: VollstÃ¤ndige Anleitung zur Integration bidirektionaler Discord-Kommentare mit Docusaurus, einschlieÃŸlich Einrichtung, Konfiguration und Fehlerbehebung.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# Discord-Kommentarintegration

Diese Dokumentationsseite beinhaltet eine **bidirektionale Discord-Kommentarintegration**, die es Besuchern ermÃ¶glicht, Kommentare an Ihren Discord-Server zu senden UND Discord-Antworten auf der Website zusammen mit den bestehenden GitHub-basierten Giscus-Kommentaren anzuzeigen.

## Merkmale

* **Bidirektionale Kommunikation**: Website-Kommentare â†’ Discord, Discord-Antworten â†’ Website
* **Doppeltes Kommentarsystem**: Sowohl Giscus (GitHub-basiert) als auch Discord-Kommentare funktionieren zusammen
* **Erweiterte Discord-Einbettungen**: Kommentare werden als formatierte Einbettungen mit vollstÃ¤ndigem Seitenkontext angezeigt.
* **Thread-Management**: Automatische Thread-Erstellung fÃ¼r Ã¼bersichtliche Antworten
* **Echtzeit-Updates**: Die Website zeigt Discord-Antworten automatisch an.
* **VollstÃ¤ndiger Seitenkontext**: Kommentare enthalten Seitentitel, URL und Navigationskontext
* **Benutzeravatare**: Discord-Antworten zeigen Benutzeravatare und Benutzernamen an.
* **Responsives Design**: Funktioniert sowohl auf Desktop- als auch auf MobilgerÃ¤ten

## Einrichtungsanleitung

### 1. Erstelle einen Discord-Bot

1. Gehe zum [Discord Developer Portal](https://discord.com/developers/applications)
2. Neue Anwendung erstellen
3. Gehen Sie zum Bereich â€Botsâ€œ und erstellen Sie einen Bot.
4. Kopiere das Bot-Token
5. Aktivieren Sie unter â€Privilegierte Gateway-Intentsâ€œ Folgendes:
   * **Inhalt der Nachricht**
   * **Absicht der Servermitglieder** (optional)

### 3) Invite Bot to Server

Ihr Bot benÃ¶tigt folgende Berechtigungen:

* Nachrichten lesen
* Nachrichten senden
* Ã–ffentliche Threads erstellen
* Nachrichten in Threads senden
* Nachrichtenverlauf lesen
* Slash-Befehle verwenden (optional)

### 6. Start the Backend Server

1. Gehen Sie zu OAuth2 > URL-Generator
2. WÃ¤hlen Sie den Bereich "Bot" aus.
3. WÃ¤hlen Sie die oben aufgefÃ¼hrten Berechtigungen aus.
4. Verwenden Sie die generierte URL, um den Bot auf Ihren Server einzuladen.

### 7) Deploy Configuration

#### Frontend (.env)

```env
# Discord-Bot-Konfiguration
DISCORD_BOT_TOKEN=Ihr_Bot-Token_hier
DISCORD_CHANNEL_ID=Ihre_Kanal-ID_hier

# API-Konfiguration
REACT_APP_API_URL=http://localhost:3001

# Discord-Kontextkonfiguration
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Ihr Seitenname
```

#### Backend-Server (server/.env)

```env
# Discord-Bot-Konfiguration
DISCORD_BOT_TOKEN=Ihr_Bot-Token_hier
DISCORD_CHANNEL_ID=Ihre_Kanal-ID_hier

# API-Konfiguration
PORT=3001

# Discord-Kontextkonfiguration
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Ihr Website-Name
```

:::Warnung Sicherheitshinweis

* `.env`-Dateien niemals in die Versionskontrolle einchecken.
* Umgebungsvariablen in der Produktion verwenden
* SchÃ¼tzen Sie Ihr Bot-Token
  :::

### 5. ServerabhÃ¤ngigkeiten installieren

```bash
cd server
npm install
```

### 6. Starten Sie den Backend-Server.

```bash
# Entwicklung
npm run dev

# Produktion
npm start
```

### 7. Bereitstellungskonfiguration

FÃ¼r Produktionsumgebungen mÃ¼ssen Sie Umgebungsvariablen in Ihrer Hosting-Plattform festlegen:

* **Frontend**: Setzen Sie `REACT_APP_API_URL` auf Ihre Produktions-API-URL.
* **Backend**: Serverordner mit Bot-Token und Kanal-ID bereitstellen
* **Datenbank**: Es wird automatisch eine SQLite-Datenbank erstellt.
* **Kontext**: Konfigurieren Sie die Discord-Kontextebene und -Optionen nach Ihren WÃ¼nschen.

## So funktioniert es

### VollstÃ¤ndiger bidirektionaler Fluss

1. **Website-Kommentar**: Der Nutzer sendet einen Kommentar Ã¼ber das Website-Formular ab.
2. **Discord-Nachricht**: Der Bot sendet formatierten Inhalt mit vollstÃ¤ndigem Seitenkontext an den Discord-Kanal.
3. **Themenerstellung**: Der Bot erstellt automatisch einen Thread fÃ¼r Ã¼bersichtliche Antworten.
4. **Discord-Antworten**: Discord-Nutzer antworten im Thread oder auf die Nachricht.
5. **Datenbankspeicherung**: Der Bot speichert alle Kommentare und Antworten in einer SQLite-Datenbank.
6. **Website-Anzeige**: Die Frontend-API fragt alle 30 Sekunden ab und zeigt die Discord-Antworten an.

### Discord-Nachrichtenformat

Discord-Einbettungen umfassen:

* **Title**: "ğŸ’¬ New Comment: \{Page Title}"
* **Beschreibung**: Der eigentliche Kommentarinhalt
* **Autor**: Name des Kommentators
* **URL**: Klickbarer Link zur entsprechenden Seite
* **Seitenfeld**: Zeigt den Seitentitel mit anklickbarem Link an
* **Zeitstempel**: Wann der Kommentar verÃ¶ffentlicht wurde
* **Thema**: Automatisch erstelltes Thema fÃ¼r Antworten

### Website-Anzeige

Auf der Webseite wird Folgendes angezeigt:

* **Originalkommentare**: FormularÃ¼bermittlungen auf der Website
* **Discord-Antworten**: Antworten von Discord-Nutzern mit Avataren und Benutzernamen
* **Echtzeit-Aktualisierungen**: Automatische Abfrage nach neuen Antworten
* **Verschachtelte Konversationen**: Strukturierte Kommentar-Antwort-Abfolge

## Kontextkonfiguration

### Kontextebenen

Konfigurieren Sie, wie viel Kontext in Discord-Nachrichten angezeigt wird:

#### `DISCORD_CONTEXT_LEVEL=minimal`

* **Angezeigt**: Nur Seitentitel und Kommentarinhalt
* **Anwendungsfall**: Klare, einfache Nachrichten ohne zusÃ¤tzlichen Kontext

#### `DISCORD_CONTEXT_LEVEL=basic`

* **Angezeigt werden:** Seitentitel, Kommentarinhalt und anklickbare Seiten-URL
* **Anwendungsfall**: Moderater Kontext mit wesentlichen Informationen

#### `DISCORD_CONTEXT_LEVEL=full` (Standard)

* **Zeigt an:** Alle Kontextinformationen einschlieÃŸlich Breadcrumbs, Abschnitte und Zeitstempel
* **Anwendungsfall**: Maximaler Kontext fÃ¼r detaillierte Diskussionen

#### `DISCORD_CONTEXT_LEVEL=custom`

* **Zeigt an**: Nur die Kontextelemente, die Sie einzeln aktivieren.
* **Anwendungsfall**: Feinabstimmung der Darstellung

### Individuelle Kontextsteuerung

Bei Verwendung von `DISCORD_CONTEXT_LEVEL=custom` kÃ¶nnen Sie jedes Element steuern:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Seitentitel und URL-Feld anzeigen
DISCORD_SHOW_BREADCRUMBS=true # Navigations-Breadcrumbs anzeigen
DISCORD_SHOW_SECTION_INFO=true # Hauptbereich anzeigen (Docker, Nextcloud usw.)
DISCORD_SHOW_PAGE_PATH=false # VollstÃ¤ndigen URL-Pfad anzeigen
DISCORD_SHOW_TIMESTAMP=true # Datum der Kommentarabgabe anzeigen
DISCORD_SHOW_AUTHOR_FIELD=true # Namen des Kommentators als Einbettungsautor anzeigen
```

### Thread-Konfiguration

```env
DISCORD_CREATE_THREADS=true # Threads fÃ¼r Antworten erstellen
DISCORD_THREAD_DURATION=1440 # Automatische Archivierungszeit der Threads (Minuten)
DISCORD_SITE_NAME=Ihr Seitenname # Seitenname in der FuÃŸzeile
```

### Beispielhafte Kontextausgaben

**Minimaler Kontext:**

```
Docker-Installationsanleitung
"Dieses Tutorial war wirklich hilfreich! Wie gehe ich mit Portkonflikten um?"
```

**Grundlegender Kontext:**

```
ğŸ’¬ Docker-Installationsanleitung
"Dieses Tutorial war wirklich hilfreich! Wie gehe ich mit Portkonflikten um?"
[Link zur Seite]
```

**VollstÃ¤ndiger Kontext:**

```
ğŸ’¬ Neuer Kommentar: Docker-Installationsanleitung
ğŸ‘¤ John Doe
"Dieses Tutorial war wirklich hilfreich! Wie gehe ich mit Portkonflikten um?"

ğŸ“„ Seite: Docker-Installationsanleitung
ğŸ“ Navigation: Docker > Dokumentation > Docker installieren
ğŸ“‚ Abschnitt: Docker
ğŸ”— Pfad: /Docker/Docs/Installing%20Ddocker/Docker%20Engine

Ihr Website-Name â€¢ Kommentarsystem
```

## Anpassung

### Styling

Die Discord-Kommentarkomponente verwendet CSS-Module. Sie kÃ¶nnen das Erscheinungsbild anpassen, indem Sie Folgendes Ã¤ndern:

```
src/components/DiscordComments/styles.module.css
```

### Nachrichtenformat

Um das Discord-Einbettungsformat anzupassen, bearbeiten Sie das `discordMessage`-Objekt in:

```
src/components/DiscordComments/index.tsx
```

### Bauteilplatzierung

Die Discord-Kommentare werden standardmÃ¤ÃŸig unterhalb der Giscus-Kommentare angezeigt. Um dies zu Ã¤ndern, gehen Sie wie folgt vor:

```
src/theme/DocItem/Layout/index.js
```

## Fehlerbehebung

### Bot antwortet nicht

1. **Bot-Token prÃ¼fen**: Stellen Sie sicher, dass `DISCORD_BOT_TOKEN` korrekt ist.
2. **Berechtigungen prÃ¼fen**: Stellen Sie sicher, dass der Bot Ã¼ber die erforderlichen Berechtigungen im Kanal verfÃ¼gt.
3. **Kanal-ID prÃ¼fen**: Stellen Sie sicher, dass `DISCORD_CHANNEL_ID` korrekt ist.
4. **Bot auf dem Server**: ÃœberprÃ¼fen Sie, ob sich der Bot tatsÃ¤chlich auf Ihrem Discord-Server befindet.

### Kommentare werden nicht angezeigt

1. **Server lÃ¤uft**: ÃœberprÃ¼fen Sie, ob der Backend-Server auf dem richtigen Port lÃ¤uft.
2. **API-URL**: ÃœberprÃ¼fen Sie, ob `REACT_APP_API_URL` auf Ihren Backend-Server verweist.
3. **Datenbank**: PrÃ¼fen Sie, ob im Serverordner eine SQLite-Datenbank erstellt wird.
4. **CORS**: Stellen Sie sicher, dass CORS fÃ¼r Ihre Frontend-Domain konfiguriert ist.

### Discord-Antworten werden nicht angezeigt

1. **Nachrichteninhaltsabsicht**: Stellen Sie sicher, dass diese Option im Discord-Entwicklerportal aktiviert ist.
2. **Bot-Berechtigungen**: Sicherstellen, dass der Bot Nachrichten im Kanal lesen kann
3. **Datenbankverbindung**: ÃœberprÃ¼fen Sie die Serverprotokolle auf Datenbankfehler.
4. **Umfragen**: Die BenutzeroberflÃ¤che fÃ¼hrt alle 30 Sekunden Umfragen durch â€“ es kann eine Weile dauern, bis die Antworten erscheinen.

### Umgebungsvariablen funktionieren nicht

* **Entwicklung**: Starten Sie sowohl die Frontend- als auch die Backend-Server neu.
* **Produktion**: Frontend und Backend mit den korrekten Umgebungsvariablen erneut bereitstellen.
* **PrÃ¤fix**: Verwenden Sie das PrÃ¤fix `REACT_APP_` nur fÃ¼r Frontend-Variablen.

### Datenbankprobleme

1. **Dateiberechtigungen**: Stellen Sie sicher, dass der Server in das Datenbankverzeichnis schreiben kann.
2. **Speicherplatz**: PrÃ¼fen Sie den verfÃ¼gbaren Speicherplatz fÃ¼r die SQLite-Datenbank.
3. **Serverprotokolle**: ÃœberprÃ¼fen Sie die Serverkonsole auf Datenbankverbindungsfehler.

## SicherheitsÃ¼berlegungen

* **Bot-Token**: Halten Sie Ihren Bot-Token geheim und speichern Sie ihn niemals in der Versionskontrolle.
* **Ratenbegrenzung**: Discord hat Ratenbegrenzungen fÃ¼r Bots (anders als fÃ¼r Webhooks).
* **Eingabevalidierung**: Sowohl Frontend als auch Backend validieren die Benutzereingaben.
* **Datenbanksicherheit**: Die SQLite-Datenbank sollte durch entsprechende Dateiberechtigungen geschÃ¼tzt werden.
* **API-Sicherheit**: ErwÃ¤gen Sie die Implementierung einer Ratenbegrenzung fÃ¼r Ihre API-Endpunkte.
* **CORS**: Konfigurieren Sie CORS ordnungsgemÃ¤ÃŸ fÃ¼r Ihre ProduktionsdomÃ¤ne.

## Architektur

```
Website-Frontend â†â†’ Express-API â†â†’ Discord-Bot â†â†’ Discord-Server
                    â†“
                SQLite-Datenbank
```

## Dateistruktur

```
project/
â”œâ”€â”€ src/components/DiscordComments/ # Frontend-Komponente
â”œâ”€â”€ server/ # Backend-Server
â”‚ â”œâ”€â”€ api.js # Express-API-Server
â”‚ â”œâ”€â”€ discord-bot.js # Discord-Bot-Logik
â”‚ â”œâ”€â”€ database.js # SQLite-Datenbankfunktionen
â”‚ â””â”€â”€ package.json # ServerabhÃ¤ngigkeiten
â””â”€â”€ docs/Discord/Docs/ # Dokumentation
```

## BrowserunterstÃ¼tzung

Die Discord-Kommentarfunktion funktioniert in allen modernen Browsern, die Folgendes unterstÃ¼tzen:

* ES6 Fetch-API
* React 18+
* CSS Grid und Flexbox
* Lokaler Speicher (zur Formularpersistenz)
