---
title: Kommentarintegration
description: Komplett guide fÃ¶r att integrera dubbelriktade Discord-kommentarer med Docusaurus, inklusive installation, konfiguration och felsÃ¶kning.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# Integrering av Discord-kommentarer

Den hÃ¤r dokumentationssidan inkluderar en **dubbelriktad integration med Discord-kommentarer** som lÃ¥ter besÃ¶kare skicka kommentarer till din Discord-server OCH visar Discord-svar tillbaka pÃ¥ webbplatsen tillsammans med befintliga GitHub-baserade Giscus-kommentarer.

## Drag

- **Dubbelriktad kommunikation**: Kommentarer pÃ¥ webbplatsen â†’ Discord, Discord-svar â†’ Webbplatsen
- **Dubbelt kommentarssystem**: BÃ¥de Giscus (GitHub-baserade) och Discord-kommentarer fungerar tillsammans.
- **Rika Discord-inbÃ¤ddningar**: Kommentarer visas som formaterade inbÃ¤ddningar med fullstÃ¤ndig sidkontext
- **TrÃ¥dhantering**: Automatisk trÃ¥dskapande fÃ¶r organiserade svar
- **Uppdateringar i realtid**: Webbplatsen visar Discord-svar automatiskt
- **FullstÃ¤ndig sidkontext**: Kommentarer inkluderar sidtitel, URL och navigeringskontext
- **AnvÃ¤ndaravatarer**: Discord-svar visar anvÃ¤ndaravatarer och anvÃ¤ndarnamn
- **Responsiv design**: Fungerar pÃ¥ bÃ¥de stationÃ¤ra och mobila enheter

## Installationsanvisningar

### 1. Create a Discord Bot

1. GÃ¥ till [Discord-utvecklarportalen](https://discord.com/developers/applications)
2. Skapa en ny applikation
3. GÃ¥ till avsnittet "Bot" och skapa en bot
4. Kopiera bot-token
5. Under "Privilegierade gateway-avsikter" aktiverar du:
   - **Meddelandets innehÃ¥llsavsikt**
   - **Servermedlemmars avsikt** (valfritt)

### 2. Configure Bot Permissions

Din bot behÃ¶ver dessa behÃ¶righeter:

- LÃ¤s meddelanden
- Skicka meddelanden
- Skapa offentliga trÃ¥dar
- Skicka meddelanden i trÃ¥dar
- LÃ¤s meddelandehistorik
- AnvÃ¤nd snedstreckkommandon (valfritt)

### 3. Invite Bot to Server

1. GÃ¥ till OAuth2 > URL-generator
2. VÃ¤lj omfattningen "bot"
3. VÃ¤lj behÃ¶righeterna som anges ovan
4. AnvÃ¤nd den genererade URL:en fÃ¶r att bjuda in boten till din server

### 4. Configure Environment Variables

#### GrÃ¤nssnitt (.env)

```env
# Discord Bot-konfiguration
DISCORD_BOT_TOKEN=din_bot_token_hÃ¤r
DISCORD_CHANNEL_ID=ditt_kanal-id_hÃ¤r

# API-konfiguration
REACT_APP_API_URL=http://localhost:3001

# Discord-kontextkonfiguration
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Ditt webbplatsnamn
```

#### Backend-server (server/.env)

```env
# Discord Bot-konfiguration
DISCORD_BOT_TOKEN=din_bot_token_hÃ¤r
DISCORD_CHANNEL_ID=ditt_kanal-id_hÃ¤r

# API-konfiguration
PORT=3001

# Discord-kontextkonfiguration
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=sant
DISCORD_SHOW_AUTHOR_FIELD=sant
DISCORD_CREATE_THREADS=sant
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Ditt webbplatsnamn
```

:::varning SÃ¤kerhetsmeddelande

- AnvÃ¤nd aldrig `.env`-filer fÃ¶r versionshantering
- AnvÃ¤nd miljÃ¶variabler i produktion
- HÃ¥ll din bot-token sÃ¤ker
  :::

### 5. Install Server Dependencies

```bash
cd-server
npm-installation
```

### 6. Start the Backend Server

```bash
# Utveckling
npm kÃ¶r dev

# Produktion
npm start
```

### 7. Deploy Configuration

FÃ¶r produktionsdistributioner, ange miljÃ¶variabler i din vÃ¤rdplattform:

- **Frontend**: Ange `REACT_APP_API_URL` till din produktions-API-URL
- **Backend**: Distribuera servermappen med bottoken och kanal-ID
- **Databas**: SQLite-databasen skapas automatiskt
- **Kontext**: Konfigurera Discord-kontextnivÃ¥ och alternativ enligt dina Ã¶nskemÃ¥l

## Hur det fungerar

### Komplett dubbelriktat flÃ¶de

1. **Kommentar pÃ¥ webbplatsen**: AnvÃ¤ndaren skickar in en kommentar via ett webbformulÃ¤r
2. **Discord-meddelande**: Boten skickar formaterad inbÃ¤ddning till Discord-kanalen med fullstÃ¤ndig sidkontext
3. **TrÃ¥dskapande**: Boten skapar automatiskt en trÃ¥d fÃ¶r organiserade svar
4. **Discord-svar**: Discord-anvÃ¤ndare svarar i trÃ¥den eller pÃ¥ meddelandet
5. **Databaslagring**: Boten lagrar alla kommentarer och svar i SQLite-databasen
6. **Webbplatsvisning**: Frontend-omrÃ¶stningar i API:et gÃ¶rs var 30:e sekund och visar Discord-svar

### Discord-meddelandeformat

Discord-inbÃ¤ddningar inkluderar:

- **Title**: "ğŸ’¬ New Comment: \{Page Title}"
- **Beskrivning**: Det faktiska innehÃ¥llet i kommentaren
- **FÃ¶rfattare**: Kommentatorns namn
- **URL**: Klickbar lÃ¤nk till exakt den sidan
- **SidfÃ¤lt**: Visar sidtitel med klickbar lÃ¤nk
- **TidsstÃ¤mpel**: NÃ¤r kommentaren publicerades
- **TrÃ¥d**: Automatiskt skapad trÃ¥d fÃ¶r svar

### Webbplatsvisning

Webbplatsen visar:

- **Ursprungliga kommentarer**: Inskickade formulÃ¤r fÃ¶r webbplatsen
- **Discord-svar**: Svar frÃ¥n Discord-anvÃ¤ndare med avatarer och anvÃ¤ndarnamn
- **Uppdateringar i realtid**: Automatisk omrÃ¶stning fÃ¶r nya svar
- **TrÃ¥dade konversationer**: Organiserad kommentar â†’ svarsstruktur

## Kontextkonfiguration

### KontextnivÃ¥er

Konfigurera hur mycket kontext som visas i Discord-meddelanden:

#### `DISCORD_CONTEXT_LEVEL=minimal`

- **Visar**: Bara sidtitel och kommentarinnehÃ¥ll
- **AnvÃ¤ndningsfall**: Rena, enkla meddelanden utan extra sammanhang

#### `DISCORD_CONTEXT_LEVEL=grundlÃ¤ggande`

- **Visar**: Sidtitel, kommentarinnehÃ¥ll och klickbar sid-URL
- **AnvÃ¤ndningsfall**: Modererat sammanhang med viktig information

#### `DISCORD_CONTEXT_LEVEL=full` (standard)

- **Visar**: All kontextinformation inklusive brÃ¶dsmulor, sektioner, tidsstÃ¤mplar
- **AnvÃ¤ndningsfall**: Maximalt sammanhang fÃ¶r detaljerade diskussioner

#### `DISCORD_CONTEXT_LEVEL=anpassad`

- **Visar**: Endast de kontextelement du aktiverar individuellt
- **AnvÃ¤ndningsfall**: Finjusterad kontroll Ã¶ver vad som visas

### Individuella kontextkontroller

NÃ¤r du anvÃ¤nder `DISCORD_CONTEXT_LEVEL=custom` kan du styra varje element:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Visa sidtitel och URL-fÃ¤lt
DISCORD_SHOW_BREADCRUMBS=true # Visa navigationsbrÃ¶dsmulor
DISCORD_SHOW_SECTION_INFO=true # Visa huvudsektion (Docker, Nextcloud, etc.)
DISCORD_SHOW_PAGE_PATH=false # Visa fullstÃ¤ndig URL-sÃ¶kvÃ¤g
DISCORD_SHOW_TIMESTAMP=true # Visa nÃ¤r kommentaren publicerades
DISCORD_SHOW_AUTHOR_FIELD=true # Visa kommentatorns namn som inbÃ¤ddad fÃ¶rfattare
```

### TrÃ¥dkonfiguration

```env
DISCORD_CREATE_THREADS=true # Skapa trÃ¥dar fÃ¶r svar
DISCORD_THREAD_DURATION=1440 # Tid fÃ¶r automatisk arkivering av trÃ¥d (minuter)
DISCORD_SITE_NAME=Ditt webbplatsnamn # Webbplatsnamn i sidfoten
```

### Exempel pÃ¥ kontextutdata

**Minimal kontext:**

```
Docker installationsguide
"Den hÃ¤r handledningen var verkligen hjÃ¤lpsam! Hur hanterar jag portkonflikter?"
```

**GrundlÃ¤ggande kontext:**

```
ğŸ’¬ Docker installationsguide
"Den hÃ¤r handledningen var verkligen hjÃ¤lpsam! Hur hanterar jag portkonflikter?"
[LÃ¤nk till sida]
```

**FullstÃ¤ndig kontext:**

```
ğŸ’¬ Ny kommentar: Docker installationsguide
ğŸ‘¤ John Doe
"Den hÃ¤r handledningen var verkligen hjÃ¤lpsam! Hur hanterar jag portkonflikter?"

ğŸ“„ Sida: Docker installationsguide
ğŸ“ Navigering: Docker > Dokument > Installera Docker
ğŸ“‚ Avsnitt: Docker
ğŸ”— SÃ¶kvÃ¤g: /Docker/Dokumentar/Installerar%20Docker/Docker%20Eengine

Ditt webbplatsnamn â€¢ Kommentarsystem
```

## Anpassning

### Styling

The Discord comments component uses CSS modules. You can customize the appearance by modifying:

```
src/komponenter/Discordkommentarer/stilar.modul.css
```

### Meddelandeformat

FÃ¶r att anpassa Discord-inbÃ¤ddningsformatet, redigera `discordMessage`-objektet i:

```
src/komponenter/Discordkommentarer/index.tsx
```

### Komponentplacering

The Discord comments appear below the Giscus comments by default. To change this, modify:

```
src/tema/DocItem/Layout/index.js
```

## FelsÃ¶kning

### Boten svarar inte

1. **Kontrollera bot-token**: Se till att `DISCORD_BOT_TOKEN` Ã¤r korrekt
2. **Verifiera behÃ¶righeter**: Se till att boten har nÃ¶dvÃ¤ndiga behÃ¶righeter i kanalen
3. **Kontrollera kanal-ID**: Se till att `DISCORD_CHANNEL_ID` Ã¤r korrekt
4. **Bot pÃ¥ servern**: Verifiera att boten faktiskt finns pÃ¥ din Discord-server

### Kommentarer visas inte

1. **Servern kÃ¶rs**: Kontrollera om backend-servern kÃ¶rs pÃ¥ rÃ¤tt port
2. **API-URL**: Verifiera att `REACT_APP_API_URL` pekar mot din backend-server
3. **Databas**: Kontrollera om SQLite-databasen skapas i servermappen
4. **CORS**: Se till att CORS Ã¤r konfigurerat fÃ¶r din frontend-domÃ¤n

### Discord-svar visas inte

1. **Meddelandets innehÃ¥llsavsikt**: Se till att detta Ã¤r aktiverat i Discord Developer Portal
2. **BotbehÃ¶righeter**: Verifiera att boten kan lÃ¤sa meddelanden i kanalen
3. **Databasanslutning**: Kontrollera serverloggarna fÃ¶r databasfel
4. **OmrÃ¶stning**: OmrÃ¶stningar frÃ¥n frontend var 30:e sekund â€“ det kan ta tid innan svaren visas

### MiljÃ¶variabler fungerar inte

- **Utveckling**: Starta om bÃ¥de frontend- och backend-servrar
- **Produktion**: Omdistribuera bÃ¥de frontend och backend med korrekta miljÃ¶variabler
- **Prefix**: AnvÃ¤nd prefixet `REACT_APP_` endast fÃ¶r frontend-variabler

### Databasproblem

1. **FilbehÃ¶righeter**: Se till att servern kan skriva till databaskatalogen
2. **Diskutrymme**: Kontrollera tillgÃ¤ngligt diskutrymme fÃ¶r SQLite-databasen
3. **Serverloggar**: Kontrollera serverkonsolen fÃ¶r databasanslutningsfel

## SÃ¤kerhetsÃ¶vervÃ¤ganden

- **Bot-token**: HÃ¥ll din bot-token hemlig och koppla den aldrig till versionshantering.
- **HastighetsgrÃ¤nser**: Discord har hastighetsgrÃ¤nser fÃ¶r bottar (skiljer sig frÃ¥n webhooks)
- **Validering av indata**: BÃ¥de frontend och backend validerar anvÃ¤ndarinmatning
- **DatabassÃ¤kerhet**: SQLite-databasen bÃ¶r skyddas med korrekta filbehÃ¶righeter
- **API-sÃ¤kerhet**: Ã–vervÃ¤g att implementera hastighetsbegrÃ¤nsningar pÃ¥ dina API-slutpunkter
- **CORS**: Konfigurera CORS korrekt fÃ¶r din produktionsdomÃ¤n

## Arkitektur

```
Webbplatsens frontend â†â†’ Express API â†â†’ Discord Bot â†â†’ Discord-server
                    â†“
                SQLite-databas
```

## Filstruktur

```
projekt/
â”œâ”€â”€ src/komponenter/Discordkommentarer/ # Frontend-komponent
â”œâ”€â”€ server/ # Backend-server
â”‚ â”œâ”€â”€ api.js # Express API-server
â”‚ â”œâ”€â”€ discord-bot.js # Discord-botlogik
â”‚ â”œâ”€â”€ database.js # SQLite-databasfunktioner
â”‚ â””â”€â”€ package.json # Serverberoenden
â””â”€â”€ docs/Discord/Dokument/ # Dokumentation
```

## WebblÃ¤sarstÃ¶d

Discord-kommentarkomponenten fungerar i alla moderna webblÃ¤sare som stÃ¶der:

- ES6 hÃ¤mtnings-API
- Reagera 18+
- CSS Grid och Flexbox
- Lokal lagring (fÃ¶r formulÃ¤rbestÃ¤ndighet)
