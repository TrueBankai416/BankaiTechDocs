---
title: Integraci√≥n de comentarios
description: Gu√≠a completa para integrar comentarios bidireccionales de Discord con Docusaurus, incluida la instalaci√≥n, configuraci√≥n y resoluci√≥n de problemas.
image: /img/social/discordia-social.jpg
sidebar_position: 2
---

# Integraci√≥n de comentarios de Discord

Este sitio de documentaci√≥n incluye una **integraci√≥n bidireccional de comentarios de Discord** que permite a los visitantes enviar comentarios a su servidor de Discord Y muestra las respuestas de Discord en el sitio web junto con los comentarios de Giscus existentes basados en GitHub.

## Caracter√≠sticas

* **Comunicaci√≥n bidireccional**: Comentarios del sitio web ‚Üí Discord, Respuestas de Discord ‚Üí Sitio web
* **Sistema de comentarios duales**: Los comentarios de Giscus (basado en GitHub) y Discord funcionan juntos
* **Incrustaciones enriquecidas de Discord**: Los comentarios aparecen como incrustaciones formateadas con contexto de p√°gina completa
* **Gesti√≥n de hilos**: Creaci√≥n autom√°tica de hilos para respuestas organizadas
* **Actualizaciones en tiempo real**: El sitio web muestra las respuestas de Discord autom√°ticamente
* **Contexto de p√°gina completa**: Los comentarios incluyen el t√≠tulo de la p√°gina, la URL y el contexto de navegaci√≥n.
* **Avatares de usuario**: Las respuestas de Discord muestran avatares de usuario y nombres de usuario.
* **Dise√±o responsivo**: funciona tanto en computadoras de escritorio como en dispositivos m√≥viles.

## Instrucciones de configuraci√≥n

### 1. Crea un bot de Discord

1. Vaya al [Portal para desarrolladores de Discord](https://discord.com/developers/applications)
2. Crear una nueva aplicaci√≥n
3. Vaya a la secci√≥n "Bot" y cree un bot.
4. Copiar el token del bot
5. En "Intentos de puerta de enlace privilegiada", habilite:
   * **Intenci√≥n del contenido del mensaje**
   * **Intenci√≥n de los miembros del servidor** (opcional)

### 3) Invite Bot to Server

Tu bot necesita estos permisos:

* Leer mensajes
* Enviar mensajes
* Crear hilos p√∫blicos
* Enviar mensajes en hilos
* Leer el historial de mensajes
* Usar comandos de barra (opcional)

### 6. Start the Backend Server

1. Vaya a OAuth2 > Generador de URL
2. Seleccionar el alcance del "bot"
3. Seleccione los permisos enumerados arriba
4. Utilice la URL generada para invitar al bot a su servidor

### 7) Deploy Configuration

#### Interfaz (.env)

```env
# Configuraci√≥n del bot de Discord
DISCORD_BOT_TOKEN=tu_token_de_bot_aqu√≠
DISCORD_CHANNEL_ID=tu_id_de_canal_aqu√≠

# Configuraci√≥n de la API
REACT_APP_API_URL=http://localhost:3001

# Configuraci√≥n del contexto de Discord
DISCORD_CONTEXT_LEVEL=completo
DISCORD_SHOW_BREADCRUMBS=verdadero
DISCORD_SHOW_SECTION_INFO=verdadero
DISCORD_SITE_NAME=Nombre de tu sitio
```

#### Servidor backend (servidor/.env)

```env
# Configuraci√≥n del bot de Discord
DISCORD_BOT_TOKEN=tu_token_de_bot_aqu√≠
DISCORD_CHANNEL_ID=tu_id_de_canal_aqu√≠

# Configuraci√≥n de la API
PORT=3001

# Configuraci√≥n del contexto de Discord
DISCORD_CONTEXT_LEVEL=completo
DISCORD_SHOW_PAGE_CONTEXT=verdadero
DISCORD_SHOW_BREADCRUMBS=verdadero
DISCORD_SHOW_SECTION_INFO=verdadero
DISCORD_SHOW_PAGE_PATH=falso
DISCORD_SHOW_TIMESTAMP=verdadero
DISCORD_SHOW_AUTHOR_FIELD=verdadero
DISCORD_CREATE_THREADS=verdadero
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Nombre de tu sitio
```

:::warning Nota de seguridad

* Nunca env√≠e archivos `.env` al control de versiones
* Utilizar variables de entorno en producci√≥n
* Mantenga su token de bot seguro
  :::

### 5. Instalar dependencias del servidor

```bash
cd servidor
npm install
```

### 6. Iniciar el servidor backend

```bash
# Desarrollo
npm run dev

# Producci√≥n
npm start
```

### 7. Implementar configuraci√≥n

Para implementaciones de producci√≥n, configure variables de entorno en su plataforma de alojamiento:

* **Frontend**: Establezca `REACT_APP_API_URL` en la URL de su API de producci√≥n
* **Backend**: Implementar la carpeta del servidor con el token del bot y el ID del canal
* **Base de datos**: La base de datos SQLite se crear√° autom√°ticamente
* **Contexto**: Configura el nivel de contexto y las opciones de Discord seg√∫n tus preferencias

## C√≥mo funciona

### Flujo bidireccional completo

1. **Comentario del sitio web**: El usuario env√≠a un comentario a trav√©s del formulario del sitio web.
2. **Mensaje de Discord**: El bot env√≠a una incrustaci√≥n formateada al canal de Discord con el contexto de p√°gina completa
3. **Creaci√≥n de hilo**: El bot crea autom√°ticamente un hilo para respuestas organizadas
4. **Respuestas de Discord**: Los usuarios de Discord responden en el hilo o en el mensaje.
5. **Almacenamiento de base de datos**: El bot almacena todos los comentarios y respuestas en la base de datos SQLite
6. **Visualizaci√≥n del sitio web**: la interfaz sondea la API cada 30 segundos y muestra las respuestas de Discord

### Formato de mensaje de Discord

Las incrustaciones de Discord incluyen:

* **Title**: "üí¨ New Comment: \{Page Title}"
* **Descripci√≥n**: El contenido real del comentario
* **Autor**: El nombre del comentarista
* **URL**: Enlace clicable a la p√°gina exacta
* **Campo de p√°gina**: Muestra el t√≠tulo de la p√°gina con un enlace en el que se puede hacer clic
* **Marca de tiempo**: Cu√°ndo se public√≥ el comentario
* **Hilo**: Hilo creado autom√°ticamente para respuestas

### Visualizaci√≥n del sitio web

El sitio web muestra:

* **Comentarios originales**: Env√≠os de formularios del sitio web
* **Respuestas de Discord**: Respuestas de usuarios de Discord con avatares y nombres de usuario
* **Actualizaciones en tiempo real**: sondeo autom√°tico para nuevas respuestas
* **Conversaciones en cadena**: Estructura organizada de comentarios ‚Üí respuestas

## Configuraci√≥n de contexto

### Niveles de contexto

Configura cu√°nto contexto aparece en los mensajes de Discord:

#### `NIVEL_DE_CONTEXTO_DE_DISCORDIA=m√≠nimo`

* **Muestra**: Solo el t√≠tulo de la p√°gina y el contenido de los comentarios
* **Caso de uso**: Mensajes limpios y simples sin contexto adicional

#### `NIVEL_DE_CONTEXTO_DE_DISCORD=b√°sico`

* **Muestra**: T√≠tulo de la p√°gina, contenido del comentario y URL de la p√°gina en la que se puede hacer clic
* **Caso de uso**: Contexto moderado con informaci√≥n esencial

#### `DISCORD_CONTEXT_LEVEL=full` (predeterminado)

* **Muestra**: Toda la informaci√≥n de contexto, incluidas las rutas de navegaci√≥n, las secciones y las marcas de tiempo.
* **Caso de uso**: Contexto m√°ximo para discusiones detalladas

#### `NIVEL_DE_TEXTO_DISCORD=personalizado`

* **Muestra**: Solo los elementos de contexto que habilita individualmente
* **Caso de uso**: Control preciso sobre lo que aparece

### Controles de contexto individuales

Al usar `DISCORD_CONTEXT_LEVEL=custom`, puedes controlar cada elemento:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Mostrar t√≠tulo de p√°gina y campo URL
DISCORD_SHOW_BREADCRUMBS=true # Mostrar migas de navegaci√≥n
DISCORD_SHOW_SECTION_INFO=true # Mostrar secci√≥n principal (Docker, Nextcloud, etc.)
DISCORD_SHOW_PAGE_PATH=false # Mostrar ruta URL completa
DISCORD_SHOW_TIMESTAMP=true # Mostrar cu√°ndo se public√≥ el comentario
DISCORD_SHOW_AUTHOR_FIELD=true # Mostrar el nombre del comentarista como autor de la incrustaci√≥n
```

### Configuraci√≥n del hilo

```env
DISCORD_CREATE_THREADS=true # Crear hilos para respuestas
DISCORD_THREAD_DURATION=1440 # Tiempo de archivado autom√°tico del hilo (minutos)
DISCORD_SITE_NAME=El nombre de su sitio # Nombre del sitio en el pie de p√°gina
```

### Ejemplos de salidas de contexto

**Contexto m√≠nimo:**

```
Gu√≠a de instalaci√≥n de Docker
"¬°Este tutorial fue realmente √∫til! ¬øC√≥mo puedo gestionar los conflictos de puertos?"
```

**Contexto b√°sico:**

```
Gu√≠a de instalaci√≥n de Docker
"¬°Este tutorial fue muy √∫til! ¬øC√≥mo puedo gestionar los conflictos de puertos?"
[Enlace a la p√°gina]
```

**Contexto completo:**

```
üí¨ Nuevo comentario: Gu√≠a de instalaci√≥n de Docker
üë§ John Doe
"¬°Este tutorial fue realmente √∫til! ¬øC√≥mo manejo los conflictos de puertos?"

üìÑ P√°gina: Gu√≠a de instalaci√≥n de Docker
üìç Navegaci√≥n: Docker > Docs > Instalaci√≥n de Docker
üìÇ Secci√≥n: Docker
üîó Ruta: /Docker/Docs/Installing%20Docker/Docker%20Engine

Nombre de su sitio ‚Ä¢ Sistema de comentarios
```

## Personalizaci√≥n

### Estilo

El componente de comentarios de Discord utiliza m√≥dulos CSS. Puedes personalizar la apariencia modificando:

```
src/componentes/DiscordComments/styles.module.css
```

### Formato del mensaje

Para personalizar el formato de incrustaci√≥n de Discord, edite el objeto `discordMessage` en:

```
src/componentes/Comentarios de Discord/index.tsx
```

### Colocaci√≥n de componentes

Los comentarios de Discord aparecen debajo de los comentarios de Giscus de forma predeterminada. Para cambiar esto, modifique:

```
src/tema/DocItem/Layout/index.js
```

## Soluci√≥n de problemas

### El bot no responde

1. **Verificar token de bot**: Aseg√∫rese de que `DISCORD_BOT_TOKEN` sea correcto
2. **Verificar permisos**: aseg√∫rese de que el bot tenga los permisos necesarios en el canal
3. **Verificar ID del canal**: Aseg√∫rese de que `DISCORD_CHANNEL_ID` sea correcto
4. **Bot en el servidor**: verifica que el bot est√© realmente en tu servidor de Discord

### Los comentarios no aparecen

1. **Servidor en ejecuci√≥n**: Verifique si el servidor backend se est√° ejecutando en el puerto correcto
2. **URL de la API**: Verifique que `REACT_APP_API_URL` apunte a su servidor backend
3. **Base de datos**: Comprueba si la base de datos SQLite se est√° creando en la carpeta del servidor
4. **CORS**: Aseg√∫rese de que CORS est√© configurado para su dominio frontend

### Las respuestas de Discord no se muestran

1. **Intenci√≥n del contenido del mensaje**: aseg√∫rese de que esto est√© habilitado en el Portal para desarrolladores de Discord
2. **Permisos del bot**: Verificar que el bot pueda leer mensajes en el canal
3. **Conexi√≥n a la base de datos**: Verifique los registros del servidor para detectar errores en la base de datos
4. **Encuestas**: La interfaz realiza encuestas cada 30 segundos; las respuestas pueden tardar en aparecer.

### Las variables de entorno no funcionan

* **Desarrollo**: Reiniciar los servidores frontend y backend
* **Producci√≥n**: Vuelva a implementar el frontend y el backend con las variables de entorno correctas
* **Prefijo**: utilice el prefijo `REACT_APP_` solo para variables del frontend

### Problemas con la base de datos

1. **Permisos de archivo**: garantizar que el servidor pueda escribir en el directorio de la base de datos
2. **Espacio en disco**: Verifique el espacio en disco disponible para la base de datos SQLite
3. **Registros del servidor**: Verifique la consola del servidor para detectar errores de conexi√≥n a la base de datos

## Consideraciones de seguridad

* **Bot Token**: Mantenga su token de bot en secreto y nunca lo env√≠e al control de versiones
* **L√≠mite de velocidad**: Discord tiene l√≠mites de velocidad para los bots (diferentes de los webhooks)
* **Validaci√≥n de entrada**: Tanto el frontend como el backend validan la entrada del usuario
* **Seguridad de la base de datos**: La base de datos SQLite debe estar protegida con los permisos de archivo adecuados
* **Seguridad de la API**: considere implementar una limitaci√≥n de velocidad en los puntos finales de su API
* **CORS**: Configure CORS correctamente para su dominio de producci√≥n

## Arquitectura

```
Interfaz del sitio web ‚Üê‚Üí API Express ‚Üê‚Üí Bot de Discord ‚Üê‚Üí Servidor de Discord
                    ‚Üì
                Base de datos SQLite
```

## Estructura de archivos

```
project/
‚îú‚îÄ‚îÄ src/components/DiscordComments/ # Componente frontend
‚îú‚îÄ‚îÄ server/ # Servidor backend
‚îÇ ‚îú‚îÄ‚îÄ api.js # Servidor de API Express
‚îÇ ‚îú‚îÄ‚îÄ discord-bot.js # L√≥gica del bot de Discord
‚îÇ ‚îú‚îÄ‚îÄ database.js # Funciones de base de datos SQLite
‚îÇ ‚îî‚îÄ‚îÄ package.json # Dependencias del servidor
‚îî‚îÄ‚îÄ docs/Discord/Docs/ # Documentaci√≥n
```

## Compatibilidad con navegadores

El componente de comentarios de Discord funciona en todos los navegadores modernos que admiten:

* API de b√∫squeda de ES6
* Reaccionar 18+
* Cuadr√≠cula CSS y Flexbox
* Almacenamiento local (para persistencia del formulario)
