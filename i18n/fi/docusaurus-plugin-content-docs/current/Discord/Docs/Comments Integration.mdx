---
title: Kommenttien integrointi
description: TÃ¤ydellinen opas kaksisuuntaisten Discord-kommenttien integrointiin Docusaurusin kanssa, mukaan lukien asennus, konfigurointi ja vianmÃ¤Ã¤ritys.
image: /img/sosiaalinen/discord-sosiaalinen.jpg
sidebar_position: 2
---

# Discord-kommenttien integrointi

TÃ¤mÃ¤ dokumentaatiosivusto sisÃ¤ltÃ¤Ã¤ **kaksisuuntaisen Discord-kommenttien integraation**, jonka avulla kÃ¤vijÃ¤t voivat lÃ¤hettÃ¤Ã¤ kommentteja Discord-palvelimellesi JA nÃ¤yttÃ¤Ã¤ Discord-vastaukset verkkosivustolla olemassa olevien GitHub-pohjaisten Giscus-kommenttien rinnalla.

## Ominaisuudet

* **Kaksisuuntainen viestintÃ¤**: Verkkosivuston kommentit â†’ Discord, Discord-vastaukset â†’ Verkkosivusto
* **KaksoiskommentointijÃ¤rjestelmÃ¤**: SekÃ¤ Giscus (GitHub-pohjainen) ettÃ¤ Discord-kommentit toimivat yhdessÃ¤
* **Rikkaat Discord-upotukset**: Kommentit nÃ¤kyvÃ¤t muotoiltuina upotuksina, joissa on koko sivun konteksti.
* **Keskusteluketjujen hallinta**: Automaattinen ketjujen luonti jÃ¤rjestettyjÃ¤ vastauksia varten
* **Reaaliaikaiset pÃ¤ivitykset**: Verkkosivusto nÃ¤yttÃ¤Ã¤ Discord-vastaukset automaattisesti
* **Koko sivun konteksti**: Kommentit sisÃ¤ltÃ¤vÃ¤t sivun otsikon, URL-osoitteen ja navigoinnin kontekstin
* **KÃ¤yttÃ¤jÃ¤avatarit**: Discord-vastaukset nÃ¤yttÃ¤vÃ¤t kÃ¤yttÃ¤jien avatarit ja kÃ¤yttÃ¤jÃ¤tunnukset
* **Responsiivinen suunnittelu**: Toimii sekÃ¤ tietokoneella ettÃ¤ mobiililaitteilla

## Asennusohjeet

### 1. Luo Discord-botti

1. Siirry [Discord-kehittÃ¤jÃ¤portaaliin](https://discord.com/developers/applications)
2. Luo uusi sovellus
3. Siirry "Botti"-osioon ja luo botti
4. Kopioi botin tunnus
5. Ota kÃ¤yttÃ¶Ã¶n kohdassa "Privileged Gateway Intents":
   * **Viestin sisÃ¤llÃ¶n tarkoitus**
   * **Palvelimen jÃ¤senten tarkoitus** (valinnainen)

### 2) Botin kÃ¤yttÃ¶oikeuksien mÃ¤Ã¤rittÃ¤minen

Bottisi tarvitsee nÃ¤mÃ¤ kÃ¤yttÃ¶oikeudet:

* Lue viestit
* LÃ¤hetÃ¤ viestejÃ¤
* Luo julkisia ketjuja
* LÃ¤hetÃ¤ viestejÃ¤ ketjuissa
* Lue viestihistoria
* KÃ¤ytÃ¤ vinoviivakomentoja (valinnainen)

### 3. Kutsu botti palvelimelle

1. Siirry kohtaan OAuth2 > URL-generaattori
2. Valitse "botti"-laajuus
3. Valitse yllÃ¤ luetellut kÃ¤yttÃ¶oikeudet
4. Kutsu botti palvelimellesi kÃ¤yttÃ¤mÃ¤llÃ¤ luotua URL-osoitetta

### 4) YmpÃ¤ristÃ¶muuttujien mÃ¤Ã¤rittÃ¤minen

#### KÃ¤yttÃ¶liittymÃ¤ (.env)

```env
# Discord-botin asetukset
DISCORD_BOT_TOKEN=bottitunnuksesi_tÃ¤ssÃ¤
DISCORD_CHANNEL_ID=kanavatunnuksesi_tÃ¤ssÃ¤

# API-asetukset
REACT_APP_API_URL=http://localhost:3001

# Discord-kontekstin asetukset
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Sivustosi nimi
```

#### Taustapalvelin (server/.env)

```env
# Discord-botin asetukset
DISCORD_BOT_TOKEN=bottisi_tunnus_tÃ¤ssÃ¤
DISCORD_CHANNEL_ID=kanavasi_tunnus_tÃ¤ssÃ¤

# API-asetukset
PORT=3001

# Discord-kontekstin asetukset
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Sivustosi nimi
```

:::varoitus Turvallisuushuomautus

* Ã„lÃ¤ koskaan sisÃ¤llytÃ¤ `.env`-tiedostoja versionhallintaan
* KÃ¤ytÃ¤ ympÃ¤ristÃ¶muuttujia tuotannossa
* PidÃ¤ bottitunnuksesi turvassa
  :::

### 5. Asenna palvelinriippuvuudet

```bash
cd-palvelin
npm-asennus
```

### 6. KÃ¤ynnistÃ¤ taustapalvelin

```bash
# Kehitys
npm suoritus dev

# Tuotanto
npm aloitus
```

### 7. KÃ¤yttÃ¶Ã¶noton mÃ¤Ã¤ritys

TuotantoympÃ¤ristÃ¶jen kÃ¤yttÃ¶Ã¶nottoja varten mÃ¤Ã¤ritÃ¤ ympÃ¤ristÃ¶muuttujat hosting-alustallasi:

* **Frontend**: Aseta `REACT_APP_API_URL` tuotanto-API-URL:ksi
* **TaustajÃ¤rjestelmÃ¤**: Ota kÃ¤yttÃ¶Ã¶n palvelinkansio bottitunnuksella ja kanavatunnuksella
* **Tietokanta**: SQLite-tietokanta luodaan automaattisesti
* **Konteksti**: MÃ¤Ã¤ritÃ¤ Discord-kontekstin taso ja asetukset mieltymystesi mukaan.

## Miten se toimii

### TÃ¤ydellinen kaksisuuntainen virtaus

1. **Verkkosivuston kommentti**: KÃ¤yttÃ¤jÃ¤ lÃ¤hettÃ¤Ã¤ kommentin verkkosivuston lomakkeen kautta.
2. **Discord-viesti**: Botti lÃ¤hettÃ¤Ã¤ muotoillun upotuksen Discord-kanavalle koko sivun kontekstilla
3. **Keskusteluketjun luonti**: Botti luo automaattisesti ketjun jÃ¤rjestettyjÃ¤ vastauksia varten.
4. **Discord-vastaukset**: Discord-kÃ¤yttÃ¤jÃ¤t vastaavat viestiketjussa tai viestiin.
5. **Tietokannan tallennus**: Botti tallentaa kaikki kommentit ja vastaukset SQLite-tietokantaan
6. **Sivuston nÃ¤yttÃ¶**: Frontend-kyselyt API:ssa 30 sekunnin vÃ¤lein ja Discord-vastaukset nÃ¤ytetÃ¤Ã¤n.

### Discord-viestin muoto

Discord-upotukset sisÃ¤ltÃ¤vÃ¤t:

* **Title**: "ğŸ’¬ New Comment: \{Page Title}"
* **Kuvaus**: Kommentin varsinainen sisÃ¤ltÃ¶
* **Kirjoittaja**: Kommentoijan nimi
* **URL**: Klikkattava linkki tÃ¤smÃ¤lleen oikealle sivulle
* **SivukenttÃ¤**: NÃ¤yttÃ¤Ã¤ sivun otsikon ja klikattavan linkin
* **Aikaleima**: Kommentin julkaisuajankohta
* **Keskusteluketju**: Automaattisesti luotu ketju vastauksia varten

### Verkkosivuston nÃ¤yttÃ¶

Verkkosivusto nÃ¤yttÃ¤Ã¤:

* **AlkuperÃ¤iset kommentit**: Verkkosivustolomakkeen lÃ¤hetykset
* **Discord-vastaukset**: Vastauksia Discord-kÃ¤yttÃ¤jiltÃ¤, joilla on avatar ja kÃ¤yttÃ¤jÃ¤tunnus
* **Reaaliaikaiset pÃ¤ivitykset**: Automaattinen kysely uusille vastauksille
* **Ketjutetut keskustelut**: JÃ¤rjestelmÃ¤llinen kommentti â†’ vastausrakenne

## Kontekstin konfigurointi

### Kontekstitasot

MÃ¤Ã¤ritÃ¤, kuinka paljon kontekstia Discord-viesteissÃ¤ nÃ¤kyy:

#### `DISCORD_CONTEXT_LEVEL=minimaalinen`

* **NÃ¤yttÃ¤Ã¤**: Vain sivun otsikko ja kommentin sisÃ¤ltÃ¶
* **KÃ¤yttÃ¶tapaus**: SelkeÃ¤t, yksinkertaiset viestit ilman lisÃ¤kontekstia

#### `DISCORD_CONTEXT_LEVEL=basic`

* **NÃ¤yttÃ¤Ã¤**: Sivun otsikon, kommenttien sisÃ¤llÃ¶n ja klikattavan sivun URL-osoitteen
* **KÃ¤yttÃ¶tapaus**: Kohtuullinen konteksti olennaisilla tiedoilla

#### `DISCORD_CONTEXT_LEVEL=full` (oletus)

* **NÃ¤yttÃ¤Ã¤**: Kaikki kontekstitiedot, mukaan lukien navigointipolut, osiot ja aikaleimat
* **KÃ¤yttÃ¶tapaus**: Maksimaalinen konteksti yksityiskohtaisille keskusteluille

#### `DISCORD_CONTEXT_LEVEL=mukautettu`

* **NÃ¤yttÃ¤Ã¤**: Vain ne kontekstielementit, jotka otat kÃ¤yttÃ¶Ã¶n erikseen
* **KÃ¤yttÃ¶tapaus**: HienosÃ¤Ã¤detty hallinta nÃ¤kyvien asioiden suhteen

### YksittÃ¤iset kontekstisÃ¤Ã¤timet

Kun kÃ¤ytÃ¤t `DISCORD_CONTEXT_LEVEL=custom`-muuttujaa, voit hallita jokaista elementtiÃ¤:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # NÃ¤ytÃ¤ sivun otsikko ja URL-kenttÃ¤
DISCORD_SHOW_BREADCRUMBS=true # NÃ¤ytÃ¤ navigoinnin polunmurut
DISCORD_SHOW_SECTION_INFO=true # NÃ¤ytÃ¤ pÃ¤Ã¤osio (Docker, Nextcloud jne.)
DISCORD_SHOW_PAGE_PATH=false # NÃ¤ytÃ¤ koko URL-polku
DISCORD_SHOW_TIMESTAMP=true # NÃ¤ytÃ¤ kommentin lÃ¤hetysaika
DISCORD_SHOW_AUTHOR_FIELD=true # NÃ¤ytÃ¤ kommentoijan nimi upotettuna kirjoittajana
```

### SÃ¤ikeen konfigurointi

```env
DISCORD_CREATE_THREADS=true # Luo ketjuja vastauksille
DISCORD_THREAD_DURATION=1440 # Ketjun automaattisen arkistoinnin aika (minuutteina)
DISCORD_SITE_NAME=Sivustosi nimi # Sivuston nimi alatunnisteessa
```

### Esimerkki kontekstituloksista

**Minimaalinen konteksti:**

```
Dockerin asennusopas
"TÃ¤mÃ¤ tutoriaali oli todella hyÃ¶dyllinen! Miten kÃ¤sittelen porttiristiriitoja?"
```

**Peruskonteksti:**

```
ğŸ’¬ Dockerin asennusopas
"TÃ¤mÃ¤ tutoriaali oli todella hyÃ¶dyllinen! Miten kÃ¤sittelen porttiristiriitoja?"
[Linkki sivulle]
```

**Koko konteksti:**

```
ğŸ’¬ Uusi kommentti: Dockerin asennusopas
ğŸ‘¤ John Doe
"TÃ¤mÃ¤ tutoriaali oli todella hyÃ¶dyllinen! Miten kÃ¤sittelen porttiristiriitoja?"

ğŸ“„ Sivu: Dockerin asennusopas
ğŸ“ Navigointi: Docker > Dokumentaatio > Dockerin asentaminen
ğŸ“‚ Osa: Docker
ğŸ”— Polku: /Docker/Docs/Asentaminen%20Docker/Docker%20Eengine

Sivustosi nimi â€¢ KommentointijÃ¤rjestelmÃ¤
```

## Mukauttaminen

### Muotoilu

Discord-kommenttikomponentti kÃ¤yttÃ¤Ã¤ CSS-moduuleja. Voit muokata ulkoasua muokkaamalla:

```
src/components/DiscordComments/styles.module.css
```

### Viestin muoto

Discord-upotusmuodon mukauttamiseksi muokkaa `discordMessage`-objektia kohdassa:

```
src/components/DiscordComments/index.tsx
```

### Komponenttien sijoittelu

Discord-kommentit nÃ¤kyvÃ¤t oletuksena Giscus-kommenttien alapuolella. Voit muuttaa tÃ¤tÃ¤ muokkaamalla:

```
src/theme/DocItem/Layout/index.js
```

## VianmÃ¤Ã¤ritys

### Botti ei vastaa

1. **Tarkista botin tunnus**: Varmista, ettÃ¤ `DISCORD_BOT_TOKEN` on oikein
2. **Tarkista kÃ¤yttÃ¶oikeudet**: Varmista, ettÃ¤ botilla on tarvittavat kÃ¤yttÃ¶oikeudet kanavalla.
3. **Tarkista kanavan tunnus**: Varmista, ettÃ¤ `DISCORD_CHANNEL_ID` on oikein
4. **Botti palvelimella**: Varmista, ettÃ¤ botti on todella Discord-palvelimellasi.

### Kommentit eivÃ¤t nÃ¤y

1. **Palvelin kÃ¤ynnissÃ¤**: Tarkista, onko taustapalvelin kÃ¤ynnissÃ¤ oikeassa portissa
2. **API-URL**: Varmista, ettÃ¤ `REACT_APP_API_URL` osoittaa taustapalvelimellesi
3. **Tietokanta**: Tarkista, luodaanko SQLite-tietokantaa palvelinkansioon.
4. **CORS**: Varmista, ettÃ¤ CORS on mÃ¤Ã¤ritetty kÃ¤yttÃ¶liittymÃ¤verkkotunnuksellesi.

### Discord-vastauksia ei nÃ¤ytetÃ¤

1. **Viestin sisÃ¤llÃ¶n tarkoitus**: Varmista, ettÃ¤ tÃ¤mÃ¤ on kÃ¤ytÃ¶ssÃ¤ Discord-kehittÃ¤jÃ¤portaalissa.
2. **Botin kÃ¤yttÃ¶oikeudet**: Varmista, ettÃ¤ botti voi lukea kanavan viestejÃ¤
3. **Tietokantayhteys**: Tarkista palvelimen lokit tietokantavirheiden varalta
4. **Kyselyt**: Frontend-kyselyt 30 sekunnin vÃ¤lein â€“ vastausten ilmestyminen voi kestÃ¤Ã¤ jonkin aikaa.

### YmpÃ¤ristÃ¶muuttujat eivÃ¤t toimi

* **Kehitys**: KÃ¤ynnistÃ¤ sekÃ¤ kÃ¤yttÃ¶liittymÃ¤- ettÃ¤ taustapalvelimet uudelleen
* **Tuotanto**: Ota sekÃ¤ kÃ¤yttÃ¶liittymÃ¤ ettÃ¤ taustajÃ¤rjestelmÃ¤ uudelleen kÃ¤yttÃ¶Ã¶n oikeilla ympÃ¤ristÃ¶muuttujilla
* **Etuliite**: KÃ¤ytÃ¤ `REACT_APP_`-etuliitettÃ¤ vain kÃ¤yttÃ¶liittymÃ¤muuttujille

### Tietokantaongelmat

1. **Tiedoston kÃ¤yttÃ¶oikeudet**: Varmista, ettÃ¤ palvelin voi kirjoittaa tietokantahakemistoon.
2. **Levytila**: Tarkista SQLite-tietokannan kÃ¤ytettÃ¤vissÃ¤ oleva levytila
3. **Palvelinlokit**: Tarkista palvelinkonsoli tietokantayhteysvirheiden varalta

## TurvallisuusnÃ¤kÃ¶kohdat

* **Bottitunnus**: PidÃ¤ bottitunnustasi salassa Ã¤lÃ¤kÃ¤ koskaan tallenna sitÃ¤ versionhallintaan.
* **Nopeusrajoitus**: Discordilla on bottien nopeusrajoituksia (eri kuin webhookien).
* **SyÃ¶tteen validointi**: SekÃ¤ kÃ¤yttÃ¶liittymÃ¤ ettÃ¤ taustajÃ¤rjestelmÃ¤ validoivat kÃ¤yttÃ¤jÃ¤n syÃ¶tteen
* **Tietokannan suojaus**: SQLite-tietokanta tulisi suojata asianmukaisilla tiedosto-oikeuksilla
* **API-tietoturva**: Harkitse nopeusrajoituksen kÃ¤yttÃ¶Ã¶nottoa API-pÃ¤Ã¤tepisteissÃ¤si
* **CORS**: MÃ¤Ã¤ritÃ¤ CORS oikein tuotantoympÃ¤ristÃ¶Ã¤si varten

## Arkkitehtuuri

```
Verkkosivuston kÃ¤yttÃ¶liittymÃ¤ â†â†’ Express-API â†â†’ Discord-botti â†â†’ Discord-palvelin
                    â†“
                SQLite-tietokanta
```

## Tiedostorakenne

```
project/
â”œâ”€â”€ src/components/DiscordComments/ # Frontend-komponentti
â”œâ”€â”€ server/ # Backend-palvelin
â”‚ â”œâ”€â”€ api.js # Express-API-palvelin
â”‚ â”œâ”€â”€ discord-bot.js # Discord-botin logiikka
â”‚ â”œâ”€â”€ database.js # SQLite-tietokantafunktiot
â”‚ â””â”€â”€ package.json # Palvelinriippuvuudet
â””â”€â”€ docs/Discord/Docs/ # Dokumentaatio
```

## Selaintuki

Discord-kommenttikomponentti toimii kaikissa nykyaikaisissa selaimissa, jotka tukevat:

* ES6-nouto-API
* React 18+
* CSS-ruudukko ja Flexbox
* Paikallinen tallennustila (lomakkeen sÃ¤ilyvyyttÃ¤ varten)
