---
title: IntÃ©gration des commentaires
description: Guide complet pour l'intÃ©gration des commentaires bidirectionnels Discord avec Docusaurus, incluant l'installation, la configuration et le dÃ©pannage.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# IntÃ©gration des commentaires Discord

Ce site de documentation inclut une **intÃ©gration bidirectionnelle des commentaires Discord** qui permet aux visiteurs d'envoyer des commentaires Ã  votre serveur Discord ET d'afficher les rÃ©ponses Discord sur le site web, en plus des commentaires Giscus existants basÃ©s sur GitHub.

## CaractÃ©ristiques

* **Communication bidirectionnelle**Â : Commentaires du site web â†’ Discord, RÃ©ponses Discord â†’ Site web
* **SystÃ¨me de commentaires double**Â : Les commentaires Giscus (basÃ© sur GitHub) et Discord fonctionnent de concert.
* **IntÃ©grations Discord enrichies**Â : Les commentaires apparaissent sous forme dâ€™intÃ©grations formatÃ©es avec le contexte de la page complÃ¨te
* **Gestion des fils de discussion**Â : CrÃ©ation automatique de fils de discussion pour des rÃ©ponses organisÃ©es
* **Mises Ã  jour en temps rÃ©el**Â : Le site web affiche automatiquement les rÃ©ponses Discord.
* **Contexte complet de la page**Â : Les commentaires incluent le titre de la page, lâ€™URL et le contexte de navigation
* **Avatars des utilisateurs**Â : Les rÃ©ponses Discord affichent les avatars et les noms dâ€™utilisateur.
* **Conception adaptative**Â : Fonctionne aussi bien sur ordinateur que sur appareils mobiles

## Instructions d'installation

### 1. CrÃ©er un bot Discord

1. AccÃ©dez au [Portail des dÃ©veloppeurs Discord](https://discord.com/developers/applications)
2. CrÃ©er une nouvelle application
3. Rendez-vous dans la section Â« Bot Â» et crÃ©ez un bot.
4. Copiez le jeton du bot
5. Sous Â«Â Intentions de passerelle privilÃ©giÃ©esÂ Â», activezÂ :
   * **Intention du contenu du message**
   * **Intention des membres du serveur** (facultatif)

### 3) Invite Bot to Server

Votre bot a besoin des autorisations suivantesÂ :

* Lire les messages
* Envoyer des messages
* CrÃ©er des fils de discussion publics
* Envoyer des messages dans les fils de discussion
* Lire l'historique des messages
* Utiliser les commandes Slash (facultatif)

### 6. Start the Backend Server

1. AccÃ©dez Ã  OAuth2 > GÃ©nÃ©rateur d'URL
2. SÃ©lectionnez la portÃ©e Â« bot Â»
3. SÃ©lectionnez les autorisations listÃ©es ci-dessus
4. Utilisez l'URL gÃ©nÃ©rÃ©e pour inviter le bot sur votre serveur.

### 7) Deploy Configuration

#### Interface utilisateur (.env)

```env
# Configuration du bot Discord
DISCORD_BOT_TOKEN=votre_jeton_bot_ici
DISCORD_CHANNEL_ID=votre_identifiant_de_canal_ici

# Configuration de l'API
REACT_APP_API_URL=http://localhost:3001

# Configuration du contexte Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Nom de votre site
```

#### Serveur backend (serveur/.env)

```env
# Configuration du bot Discord
DISCORD_BOT_TOKEN=votre_jeton_bot_ici
DISCORD_CHANNEL_ID=votre_identifiant_de_canal_ici

# Configuration de l'API
PORT=3001

# Configuration du contexte Discord
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Nom de votre site
```

Note de sÃ©curitÃ© :::avertissement

* Ne jamais versionner les fichiers `.env`.
* Utiliser les variables d'environnement en production
* SÃ©curisez votre jeton de bot
  :::

### 5. Installer les dÃ©pendances du serveur

```bash
serveur cd
npm install
```

### 6. DÃ©marrer le serveur backend

```bash
# DÃ©veloppement
npm run dev

# Production
npm start
```

### 7. Configuration de dÃ©ploiement

Pour les dÃ©ploiements en production, dÃ©finissez les variables d'environnement sur votre plateforme d'hÃ©bergementÂ :

* **Frontend**Â : DÃ©finissez `REACT_APP_API_URL` sur lâ€™URL de votre API de production.
* **Backend**Â : DÃ©ployez le dossier serveur contenant le jeton du bot et lâ€™ID du canal.
* **Base de donnÃ©es**Â : Une base de donnÃ©es SQLite sera crÃ©Ã©e automatiquement.
* **Contexte**Â : Configurez le niveau de contexte et les options de Discord selon vos prÃ©fÃ©rences.

## Comment Ã§a marche

### Flux bidirectionnel complet

1. **Commentaire sur le site web**Â : Lâ€™utilisateur soumet un commentaire via le formulaire du site web.
2. **Message Discord**Â : Le bot envoie un contenu intÃ©grÃ© formatÃ© sur le canal Discord avec le contexte complet de la page.
3. **CrÃ©ation de fil de discussion**Â : Le bot crÃ©e automatiquement un fil de discussion pour des rÃ©ponses organisÃ©es.
4. **RÃ©ponses Discord**Â : Les utilisateurs de Discord rÃ©pondent dans la discussion ou au message.
5. **Stockage de la base de donnÃ©es**Â : Le bot stocke tous les commentaires et rÃ©ponses dans une base de donnÃ©es SQLite.
6. **Affichage du site web**Â : Lâ€™interface interroge lâ€™API toutes les 30Â secondes et affiche les rÃ©ponses Discord.

### Format des messages Discord

Les intÃ©grations Discord incluentÂ :

* **Title**: "ğŸ’¬ New Comment: \{Page Title}"
* **Description**Â : Le contenu du commentaire lui-mÃªme
* **Auteur**Â : Nom du commentateur
* **URL**Â : Lien cliquable vers la page exacte
* **Champ Page**Â : Affiche le titre de la page avec un lien cliquable
* **Date et heure de publication du commentaire**Â : Date et heure de publication du commentaire
* **Sujet**Â : Fil de discussion crÃ©Ã© automatiquement pour les rÃ©ponses

### Affichage du site Web

Le site web afficheÂ :

* **Commentaires originaux**Â : Soumissions de formulaires sur le site Web
* **RÃ©ponses Discord**Â : RÃ©ponses des utilisateurs Discord avec avatar et nom dâ€™utilisateur
* **Mises Ã  jour en temps rÃ©el**Â : Sondage automatique pour recueillir les nouvelles rÃ©ponses
* **Conversations par fil de discussion**Â : Structure organisÃ©e des commentaires et des rÃ©ponses

## Configuration du contexte

### Niveaux de contexte

Configurez le niveau de contexte affichÃ© dans les messages DiscordÂ :

#### `DISCORD_CONTEXT_LEVEL=minimal`

* **Affiche**Â : Titre de la page et contenu des commentaires uniquement
* **Cas d'utilisation**Â : Messages clairs et simples, sans contexte supplÃ©mentaire

#### `DISCORD_CONTEXT_LEVEL=basic`

* **Affiche**Â : Titre de la page, contenu du commentaire et URL cliquable de la page
* **Cas d'utilisation**Â : Contexte modÃ©rÃ© avec informations essentielles

#### `DISCORD_CONTEXT_LEVEL=full` (par dÃ©faut)

* **Affiche**Â : Toutes les informations contextuelles, y compris le fil dâ€™Ariane, les sections et les horodatages.
* **Cas d'utilisation**Â : Contexte maximal pour des discussions dÃ©taillÃ©es

#### `DISCORD_CONTEXT_LEVEL=personnalisÃ©`

* **Affiche**Â : Seuls les Ã©lÃ©ments de contexte que vous activez individuellement sont affichÃ©s.
* **Cas d'utilisation**Â : ContrÃ´le prÃ©cis de ce qui apparaÃ®t

### ContrÃ´les du contexte individuel

Lorsque vous utilisez `DISCORD_CONTEXT_LEVEL=custom`, vous pouvez contrÃ´ler chaque Ã©lÃ©mentÂ :

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Afficher le titre et l'URL de la page
DISCORD_SHOW_BREADCRUMBS=true # Afficher le fil d'Ariane
DISCORD_SHOW_SECTION_INFO=true # Afficher la section principale (Docker, Nextcloud, etc.)
DISCORD_SHOW_PAGE_PATH=false # Afficher le chemin complet de l'URL
DISCORD_SHOW_TIMESTAMP=true # Afficher la date et l'heure de publication du commentaire
DISCORD_SHOW_AUTHOR_FIELD=true # Afficher le nom de l'auteur du commentaire
```

### Configuration du thread

```env
DISCORD_CREATE_THREADS=true # CrÃ©er des fils de discussion pour les rÃ©ponses
DISCORD_THREAD_DURATION=1440 # DurÃ©e d'archivage automatique des fils de discussion (minutes)
DISCORD_SITE_NAME=Nom de votre site # Nom du site dans le pied de page
```

### Exemples de sorties contextuelles

**Contexte minimal :**

```
Guide d'installation de Docker
Â« Ce tutoriel Ã©tait vraiment utile ! Comment gÃ©rer les conflits de ports ? Â»
```

**Contexte de base :**

```
ğŸ’¬ Guide d'installation de Docker
Â« Ce tutoriel Ã©tait vraiment utileÂ ! Comment gÃ©rer les conflits de portsÂ ? Â»
[Lien vers la page]
```

**Contexte completÂ :**

```
ğŸ’¬ Nouveau commentaireÂ : Guide d'installation de Docker
ğŸ‘¤ John Doe
Â«Â Ce tutoriel Ã©tait vraiment utileÂ ! Comment gÃ©rer les conflits de portsÂ ?Â Â»

ğŸ“„ PageÂ : Guide d'installation de Docker
ğŸ“ NavigationÂ : Docker > Documentation > Installation de Docker
ğŸ“‚ SectionÂ : Docker
ğŸ”— CheminÂ : /Docker/Docs/Installing%20Docker/Docker%20Engine

Nom de votre site â€¢ SystÃ¨me de commentaires
```

## Personnalisation

### stylisme

Le composant de commentaires Discord utilise des modules CSS. Vous pouvez personnaliser l'apparence en modifiantÂ :

```
src/components/DiscordComments/styles.module.css
```

### Format du message

Pour personnaliser le format d'intÃ©gration Discord, modifiez l'objet `discordMessage` dansÂ :

```
src/components/DiscordComments/index.tsx
```

### Placement des composants

Les commentaires Discord apparaissent par dÃ©faut sous les commentaires Giscus. Pour modifier cela, modifiezÂ :

```
src/theme/DocItem/Layout/index.js
```

## DÃ©pannage

### Le bot ne rÃ©pond pas

1. **VÃ©rifiez le jeton du bot**Â : Assurez-vous que `DISCORD_BOT_TOKEN` est correct.
2. **VÃ©rifier les autorisations**Â : Assurez-vous que le bot dispose des autorisations requises sur le canal.
3. **VÃ©rifiez l'ID du canal**Â : Assurez-vous que `DISCORD_CHANNEL_ID` est correct.
4. **Bot sur le serveur**Â : VÃ©rifiez que le bot est bien prÃ©sent sur votre serveur Discord.

### Commentaires non affichÃ©s

1. **Serveur en cours d'exÃ©cution**Â : VÃ©rifiez si le serveur backend est en cours d'exÃ©cution sur le port correct.
2. **URL de l'API**Â : VÃ©rifiez que `REACT_APP_API_URL` pointe vers votre serveur backend.
3. **Base de donnÃ©es**Â : VÃ©rifier si une base de donnÃ©es SQLite est en cours de crÃ©ation dans le dossier du serveur
4. **CORS**Â : Assurez-vous que CORS est configurÃ© pour votre domaine frontal.

### Les rÃ©ponses Discord ne s'affichent pas

1. **Intention du contenu du message**Â : Assurez-vous que cette option est activÃ©e dans le portail dÃ©veloppeur Discord.
2. **Autorisations du bot**Â : VÃ©rifier que le bot peut lire les messages du canal
3. **Connexion Ã  la base de donnÃ©es**Â : Consultez les journaux du serveur pour dÃ©tecter les erreurs de base de donnÃ©es.
4. **Sondage**Â : Lâ€™interface utilisateur effectue un sondage toutes les 30Â secondesÂ ; les rÃ©ponses peuvent mettre un certain temps Ã  sâ€™afficher.

### Les variables d'environnement ne fonctionnent pas

* **DÃ©veloppement**Â : RedÃ©marrez les serveurs frontend et backend.
* **Production**Â : RedÃ©ployer le frontend et le backend avec les variables dâ€™environnement correctes
* **PrÃ©fixe**Â : Utilisez le prÃ©fixe `REACT_APP_` uniquement pour les variables frontend.

### ProblÃ¨mes de base de donnÃ©es

1. **Permissions d'accÃ¨s aux fichiers**Â : Assurez-vous que le serveur dispose des droits d'Ã©criture dans le rÃ©pertoire de la base de donnÃ©es.
2. **Espace disque**Â : VÃ©rifiez lâ€™espace disque disponible pour la base de donnÃ©es SQLite.
3. **Journaux du serveur**Â : Consultez la console du serveur pour dÃ©tecter les erreurs de connexion Ã  la base de donnÃ©es.

## ConsidÃ©rations de sÃ©curitÃ©

* **Jeton du bot**Â : Gardez votre jeton de bot secret et ne le publiez jamais dans un systÃ¨me de contrÃ´le de version.
* **Limitation du dÃ©bit**Â : Discord impose des limites de dÃ©bit aux bots (diffÃ©rentes des limites des webhooks).
* **Validation des entrÃ©es**Â : Les entrÃ©es utilisateur sont validÃ©es Ã  la fois cÃ´tÃ© client et cÃ´tÃ© serveur.
* **SÃ©curitÃ© de la base de donnÃ©es**Â : La base de donnÃ©es SQLite doit Ãªtre protÃ©gÃ©e par des permissions de fichiers appropriÃ©es.
* **SÃ©curitÃ© des API**Â : Envisagez de mettre en Å“uvre une limitation du dÃ©bit sur vos points de terminaison dâ€™API.
* **CORS**Â : Configurez correctement CORS pour votre domaine de production

## Architecture

```
Interface du site web â†â†’ API Express â†â†’ Bot Discord â†â†’ Serveur Discord
                    â†“
                Base de donnÃ©es SQLite
```

## Structure des fichiers

```
projet/
â”œâ”€â”€ src/components/DiscordComments/ # Composant frontend
â”œâ”€â”€ server/ # Serveur backend
â”‚ â”œâ”€â”€ api.js # Serveur API Express
â”‚ â”œâ”€â”€ discord-bot.js # Logique du bot Discord
â”‚ â”œâ”€â”€ database.js # Fonctions de la base de donnÃ©es SQLite
â”‚ â””â”€â”€ package.json # DÃ©pendances du serveur
â””â”€â”€ docs/Discord/Docs/ # Documentation
```

## Prise en charge du navigateur

Le composant de commentaires Discord fonctionne dans tous les navigateurs modernes qui prennent en chargeÂ :

* API de rÃ©cupÃ©ration ES6
* RÃ©action 18+
* CSS Grid et Flexbox
* Stockage local (pour la persistance des formulaires)
