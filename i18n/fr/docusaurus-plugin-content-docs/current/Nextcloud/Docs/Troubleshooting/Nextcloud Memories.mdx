---
title: Nextcloud Memories
description: Troubleshooting guide for Nextcloud Memories including geometry table setup, database triggers, and image preview issues.
image: /img/social/nextcloud-memories-social.png
sidebar_position: 2
tags:
  - Docker
  - Nextcloud
  - Tutorial
  - Troubleshooting
keywords:
  - Docker
  - Docker Engine
  - Tutorial
  - Nextcloud
  - Troubleshooting
last_update:
  author: BankaiTech
---

import BuyMeACoffeeButton from '@site/src/components/BuyMeACoffeeButton';

## Troubleshooting for Nextcloud Memories

### Geometry table has not been created

![Geometry Table](/img/nextcloud/Troubleshooting/GeoTable.jpg)

<p>
  <>Run the following command.</>
</p>

### **_Database triggers are not set up correctly._**

<p>
  <>You need to add `--log_bin_trust_function_creators=true` to `command:` for `mariadb` in you `docker-compose.yaml` file.</>
</p>

### **Image Previews Show Incorrect Images**

<p>
  <>When image previews display one image but downloading and viewing shows a different image, this indicates corrupted preview cache. Follow these steps to fix the issue:</>
</p>

**Step 1: Verify the directory structure**

```bash
ls /var/docker/nextcloud/nextcloud/data
```

<p>
  <>You should see `appdata_<instanceid>` in the output. Note: Your Nextcloud path may differ (some setups use `/etc/docker/nextcloud/nextcloud/data`). Adjust the path according to your setup.</>
</p>

<p>
  <>To identify the instance ID more easily, you can also run:</>
</p>

**Step 2: Navigate to the appdata directory**

```bash
cd /var/docker/nextcloud/nextcloud/data/appdata_<instanceid>
```

<p>
  <>Replace `<instanceid>` with the actual instance ID you saw in Step 1.</>
</p>

**Step 3: Verify location and remove the corrupted preview directory**

```bash
pwd
ls -d preview
```

<p>
  <>Confirm you're in the correct appdata directory and that the preview directory exists.</>
</p>

:::caution[Destructive Operation]
The following command will permanently delete the preview cache. Make sure you're in the correct directory before proceeding.
:::

```bash
sudo rm -rf ./preview
```

**Step 4: Regenerate all previews**

```bash
sudo docker exec -it -u 33 nextcloud php occ preview:generate-all
```

<p>
  <>Change `nextcloud` to your actual container name if different. Once completed, it will still take some time for previews to populate on the web interface.</>
</p>

:::info[Preview Generator App Required]

```bash
sudo docker exec -it -u 33 nextcloud php occ app:install previewgenerator
sudo docker exec -it -u 33 nextcloud php occ app:enable previewgenerator
```

Then retry the preview generation command.
:::

## **Resources**

[Geometry Table](https://memories.gallery/troubleshooting/#trigger-compatibility-mode)

<BuyMeACoffeeButton />
