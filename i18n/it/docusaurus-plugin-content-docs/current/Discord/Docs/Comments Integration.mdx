---
title: Integrazione dei commenti
description: Guida completa all'integrazione dei commenti bidirezionali di Discord con Docusaurus, inclusa l'installazione, la configurazione e la risoluzione dei problemi.
image: /img/social/discord-social.jpg
sidebar_position: 2
---

# Integrazione dei commenti di Discord

Questo sito di documentazione include un'**integrazione bidirezionale dei commenti Discord** che consente ai visitatori di inviare commenti al tuo server Discord E visualizza le risposte Discord sul sito web insieme ai commenti Giscus basati su GitHub.

## Caratteristiche

- **Comunicazione bidirezionale**: Commenti sul sito web ‚Üí Discord, Risposte Discord ‚Üí Sito web
- **Doppio sistema di commenti**: i commenti di Giscus (basato su GitHub) e Discord funzionano insieme
- **Incorporamenti Discord avanzati**: i commenti vengono visualizzati come incorporamenti formattati con contesto a pagina intera
- **Gestione thread**: creazione automatica di thread per risposte organizzate
- **Aggiornamenti in tempo reale**: il sito web visualizza automaticamente le risposte Discord
- **Contesto pagina intera**: i commenti includono il titolo della pagina, l'URL e il contesto di navigazione
- **Avatar utente**: le risposte Discord mostrano gli avatar e i nomi utente degli utenti
- **Design reattivo**: funziona sia su dispositivi desktop che mobili

## Istruzioni di installazione

### 1. Crea un bot Discord

1. Vai al [Portale sviluppatori Discord](https://discord.com/developers/applications)
2. Crea una nuova applicazione
3. Vai alla sezione "Bot" e crea un bot
4. Copia il token del bot
5. In "Privileged Gateway Intents", abilita:
   - **Intento del contenuto del messaggio**
   - **Intento dei membri del server** (facoltativo)

### 7. Configurazione di distribuzione

Il tuo bot necessita di queste autorizzazioni:

- Leggi i messaggi
- Invia messaggi
- Crea discussioni pubbliche
- Invia messaggi in thread
- Leggi la cronologia dei messaggi
- Utilizzare i comandi slash (facoltativo)

### 6. Avviare il server backend

1. Vai su OAuth2 > Generatore URL
2. Seleziona l'ambito "bot"
3. Seleziona le autorizzazioni elencate sopra
4. Utilizza l'URL generato per invitare il bot sul tuo server

### 5. Installa le dipendenze del server

#### Frontend (.env)

```env
# Configurazione del bot Discord
DISCORD_BOT_TOKEN=il_tuo_token_bot_qui
DISCORD_CHANNEL_ID=il_tuo_id_canale_qui

# Configurazione API
REACT_APP_API_URL=http://localhost:3001

# Configurazione del contesto Discord
DISCORD_CONTEXT_LEVEL=completo
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Il nome del tuo sito
```

#### Server back-end (server/.env)

```env
# Configurazione del bot Discord
DISCORD_BOT_TOKEN=il_tuo_token_bot_qui
DISCORD_CHANNEL_ID=il_tuo_id_canale_qui

# Configurazione API
PORT=3001

# Configurazione del contesto Discord
DISCORD_CONTEXT_LEVEL=completo
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=false
DISCORD_SHOW_TIMESTAMP=true
DISCORD_SHOW_AUTHOR_FIELD=true
DISCORD_CREATE_THREADS=true
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Il nome del tuo sito
```

:::warning Nota di sicurezza

- Non inviare mai i file `.env` al controllo di versione
- Utilizzare le variabili di ambiente in produzione
- Mantieni sicuro il tuo token bot
  :::

### 6. Start the Backend Server

```bash
cd server
installazione npm
```

### 6. Start the Backend Server

```bash
# Sviluppo
npm run dev

# Produzione
npm start
```

### 7. 7. Deploy Configuration

Per le distribuzioni di produzione, imposta le variabili di ambiente nella tua piattaforma di hosting:

- **Frontend**: imposta `REACT_APP_API_URL` sull'URL della tua API di produzione
- **Backend**: distribuisci la cartella del server con il token bot e l'ID del canale
- **Database**: il database SQLite verr√† creato automaticamente
- **Contesto**: configura il livello di contesto e le opzioni di Discord in base alle tue preferenze

## Come funziona

### Flusso bidirezionale completo

1. **Commento sul sito web**: l'utente invia un commento tramite il modulo del sito web
2. **Messaggio Discord**: il bot invia un messaggio formattato incorporato al canale Discord con il contesto completo della pagina
3. **Creazione thread**: il bot crea automaticamente un thread per le risposte organizzate
4. **Risposte Discord**: gli utenti Discord rispondono nel thread o al messaggio
5. **Archiviazione database**: il bot memorizza tutti i commenti e le risposte nel database SQLite
6. **Visualizzazione del sito web**: l'API dei sondaggi front-end ogni 30 secondi e visualizza le risposte di Discord

### Formato dei messaggi Discord

Gli incorporamenti di Discord includono:

- **Title**: "üí¨ New Comment: \{Page Title}"
- **Descrizione**: Il contenuto effettivo del commento
- **Autore**: Nome del commentatore
- **URL**: Link cliccabile alla pagina esatta
- **Campo pagina**: mostra il titolo della pagina con collegamento cliccabile
- **Timestamp**: Quando √® stato pubblicato il commento
- **Discussione**: Discussione creata automaticamente per le risposte

### Visualizzazione del sito web

Il sito web mostra:

- **Commenti originali**: Invio di moduli al sito web
- **Risposte Discord**: Risposte degli utenti Discord con avatar e nomi utente
- **Aggiornamenti in tempo reale**: sondaggio automatico per nuove risposte
- **Conversazioni a thread**: struttura commento organizzato ‚Üí risposta

## Configurazione del contesto

### Livelli di contesto

Configura la quantit√† di contesto visualizzata nei messaggi Discord:

#### `DISCORD_CONTEXT_LEVEL=minimo`

- **Mostra**: Solo il titolo della pagina e il contenuto del commento
- **Caso d'uso**: messaggi puliti e semplici senza contesto aggiuntivo

#### `DISCORD_CONTEXT_LEVEL=base`

- **Mostra**: Titolo della pagina, contenuto del commento e URL della pagina cliccabile
- **Caso d'uso**: contesto moderato con informazioni essenziali

#### `DISCORD_CONTEXT_LEVEL=full` (predefinito)

- **Mostra**: Tutte le informazioni di contesto, inclusi breadcrumb, sezioni, timestamp
- **Caso d'uso**: Contesto massimo per discussioni dettagliate

#### `DISCORD_CONTEXT_LEVEL=personalizzato`

- **Mostra**: Solo gli elementi di contesto che abiliti individualmente
- **Caso d'uso**: Controllo preciso su ci√≤ che appare

### Controlli contestuali individuali

Utilizzando `DISCORD_CONTEXT_LEVEL=custom`, √® possibile controllare ciascun elemento:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Mostra il titolo della pagina e il campo URL
DISCORD_SHOW_BREADCRUMBS=true # Mostra i breadcrumb di navigazione
DISCORD_SHOW_SECTION_INFO=true # Mostra la sezione principale (Docker, Nextcloud, ecc.)
DISCORD_SHOW_PAGE_PATH=false # Mostra il percorso URL completo
DISCORD_SHOW_TIMESTAMP=true # Mostra quando √® stato pubblicato il commento
DISCORD_SHOW_AUTHOR_FIELD=true # Mostra il nome del commentatore come autore dell'incorporamento
```

### Configurazione del thread

```env
DISCORD_CREATE_THREADS=true # Crea thread per le risposte
DISCORD_THREAD_DURATION=1440 # Tempo di archiviazione automatica del thread (minuti)
DISCORD_SITE_NAME=Nome del tuo sito # Nome del sito nel pi√® di pagina
```

### Esempio di output di contesto

**Contesto minimo:**

```
Guida all'installazione di Docker
"Questo tutorial √® stato davvero utile! Come posso gestire i conflitti di porta?"
```

**Contesto di base:**

```
üí¨ Guida all'installazione di Docker
"Questo tutorial √® stato davvero utile! Come gestisco i conflitti di porta?"
[Link alla pagina]
```

**Contesto completo:**

```
üí¨ Nuovo commento: Guida all'installazione di Docker
üë§ John Doe
"Questo tutorial √® stato davvero utile! Come gestisco i conflitti di porta?"

üìÑ Pagina: Guida all'installazione di Docker
üìç Navigazione: Docker > Documentazione > Installazione di Docker
üìÇ Sezione: Docker
üîó Percorso: /Docker/Docs/Installing%20Docker/Docker%20Engine

Nome del tuo sito ‚Ä¢ Sistema di commenti
```

## Personalizzazione

### Stile

Il componente commenti di Discord utilizza moduli CSS. √à possibile personalizzare l'aspetto modificando:

```
src/components/DiscordComments/styles.module.css
```

### Formato del messaggio

Per personalizzare il formato di incorporamento di Discord, modifica l'oggetto `discordMessage` in:

```
src/components/DiscordComments/index.tsx
```

### Posizionamento dei componenti

Per impostazione predefinita, i commenti Discord vengono visualizzati sotto i commenti Giscus. Per cambiare questa impostazione, modifica:

```
src/tema/DocItem/Layout/index.js
```

## Risoluzione dei problemi

### Bot non risponde

1. **Controlla il token del bot**: assicurati che `DISCORD_BOT_TOKEN` sia corretto
2. **Verifica autorizzazioni**: assicurati che il bot abbia le autorizzazioni richieste nel canale
3. **Controlla l'ID del canale**: assicurati che `DISCORD_CHANNEL_ID` sia corretto
4. **Bot nel server**: verifica che il bot sia effettivamente nel tuo server Discord

### Commenti non visualizzati

1. **Server in esecuzione**: controlla se il server backend √® in esecuzione sulla porta corretta
2. **URL API**: verifica che `REACT_APP_API_URL` punti al tuo server backend
3. **Database**: controlla se il database SQLite √® in fase di creazione nella cartella del server
4. **CORS**: assicurati che CORS sia configurato per il tuo dominio frontend

### Le risposte di Discord non vengono visualizzate

1. **Intento del contenuto del messaggio**: assicurati che sia abilitato nel portale sviluppatori Discord
2. **Autorizzazioni bot**: verifica che il bot possa leggere i messaggi nel canale
3. **Connessione al database**: controlla i log del server per errori del database
4. **Sondaggi**: il frontend effettua sondaggi ogni 30 secondi; la visualizzazione delle risposte potrebbe richiedere del tempo

### Variabili d'ambiente non funzionanti

- **Sviluppo**: riavviare entrambi i server frontend e backend
- **Produzione**: ridistribuire sia il frontend che il backend con le variabili di ambiente corrette
- **Prefisso**: utilizzare il prefisso `REACT_APP_` solo per le variabili frontend

### Problemi di database

1. **Autorizzazioni file**: assicurarsi che il server possa scrivere nella directory del database
2. **Spazio su disco**: controlla lo spazio su disco disponibile per il database SQLite
3. **Registri del server**: controlla la console del server per errori di connessione al database

## Considerazioni sulla sicurezza

- **Token del bot**: mantieni segreto il tuo token del bot e non sottoporlo mai al controllo di versione
- **Limitazione della frequenza**: Discord ha dei limiti di frequenza per i bot (diversi dai webhook)
- **Convalida dell'input**: sia il frontend che il backend convalidano l'input dell'utente
- **Sicurezza del database**: il database SQLite deve essere protetto con le autorizzazioni file appropriate
- **Sicurezza API**: valuta l'implementazione di una limitazione della velocit√† sugli endpoint API
- **CORS**: configura CORS correttamente per il tuo dominio di produzione

## Architettura

```
Frontend del sito web ‚Üê‚Üí API Express ‚Üê‚Üí Bot Discord ‚Üê‚Üí Server Discord
                    ‚Üì
                Database SQLite
```

## Struttura del file

```
project/
‚îú‚îÄ‚îÄ src/components/DiscordComments/ # Componente frontend
‚îú‚îÄ‚îÄ server/ # Server backend
‚îÇ ‚îú‚îÄ‚îÄ api.js # Server API Express
‚îÇ ‚îú‚îÄ‚îÄ discord-bot.js # Logica del bot Discord
‚îÇ ‚îú‚îÄ‚îÄ database.js # Funzioni del database SQLite
‚îÇ ‚îî‚îÄ‚îÄ package.json # Dipendenze del server
‚îî‚îÄ‚îÄ docs/Discord/Docs/ # Documentazione
```

## Supporto del browser

Il componente commenti di Discord funziona in tutti i browser moderni che supportano:

- API di recupero ES6
- Reagisci 18+
- Griglia CSS e Flexbox
- Archiviazione locale (per la persistenza del modulo)
