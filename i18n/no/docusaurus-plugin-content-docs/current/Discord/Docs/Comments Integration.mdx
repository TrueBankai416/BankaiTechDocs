---
title: Kommentarintegrasjon
description: Komplett guide til Ã¥ integrere toveis Discord-kommentarer med Docusaurus, inkludert oppsett, konfigurasjon og feilsÃ¸king.
image: /img/sosial/discord-sosial.jpg
sidebar_position: 2
---

# Integrering av Discord-kommentarer

Dette dokumentasjonsnettstedet inkluderer en **toveis integrering av Discord-kommentarer** som lar besÃ¸kende sende kommentarer til Discord-serveren din OG viser Discord-svar tilbake pÃ¥ nettstedet sammen med de eksisterende GitHub-baserte Giscus-kommentarene.

## Funksjoner

* **Toveiskommunikasjon**: Kommentarer til nettstedet â†’ Discord, svar til Discord â†’ Nettsted
* **Dobbelt kommentarsystem**: BÃ¥de Giscus (GitHub-basert) og Discord-kommentarer fungerer sammen
* **Rike Discord-innlegg**: Kommentarer vises som formaterte innlegg med full sidekontekst
* **TrÃ¥dhÃ¥ndtering**: Automatisk trÃ¥doppretting for organiserte svar
* **Oppdateringer i sanntid**: Nettstedet viser Discord-svar automatisk
* **Fullstendig sidekontekst**: Kommentarer inkluderer sidetittel, URL og navigasjonskontekst
* **Brukeravatarer**: Discord-svar viser brukeravatarer og brukernavn
* **Responsivt design**: Fungerer pÃ¥ bÃ¥de stasjonÃ¦re og mobile enheter

## Oppsettinstruksjoner

### 1. Lag en Discord-bot

1. GÃ¥ til [Discord-utviklerportalen](https://discord.com/developers/applications)
2. Opprett en ny applikasjon
3. GÃ¥ til Â«BotÂ»-delen og opprett en bot
4. Kopier bot-tokenet
5. Under Â«Privilegerte gateway-intensjonerÂ» aktiverer du:
   * **Intensjon for meldingsinnhold**
   * **Servermedlemmers intensjon** (valgfritt)

### 2) Konfigurer bottillatelser

Boten din trenger disse tillatelsene:

* Les meldinger
* Send meldinger
* Opprett offentlige trÃ¥der
* Send meldinger i trÃ¥der
* Les meldingsloggen
* Bruk skrÃ¥strekekommandoer (valgfritt)

### 3. Inviter bot til serveren

1. GÃ¥ til OAuth2 > URL-generator
2. Velg omfanget Â«botÂ»
3. Velg tillatelsene som er oppfÃ¸rt ovenfor
4. Bruk den genererte URL-en til Ã¥ invitere boten til serveren din

### 4) Konfigurer miljÃ¸variabler

#### Grensesnitt (.env)

```env
# Discord Bot-konfigurasjon
DISCORD_BOT_TOKEN=din_bot_token_her
DISCORD_CHANNEL_ID=din_kanal_ID_her

# API-konfigurasjon
REACT_APP_API_URL=http://localhost:3001

# Discord-kontekstkonfigurasjon
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SITE_NAME=Navn pÃ¥ nettstedet ditt
```

#### Backend-server (server/.env)

```env
# Discord Bot-konfigurasjon
DISCORD_BOT_TOKEN=din_bot-token_her
DISCORD_CHANNEL_ID=din_kanal-ID_her

# API-konfigurasjon
PORT=3001

# Discord-kontekstkonfigurasjon
DISCORD_CONTEXT_LEVEL=full
DISCORD_SHOW_PAGE_CONTEXT=true
DISCORD_SHOW_BREADCRUMBS=true
DISCORD_SHOW_SECTION_INFO=true
DISCORD_SHOW_PAGE_PATH=usann
DISCORD_SHOW_TIMESTAMP=sann
DISCORD_SHOW_AUTHOR_FIELD=sann
DISCORD_CREATE_THREADS=sann
DISCORD_THREAD_DURATION=1440
DISCORD_SITE_NAME=Navn pÃ¥ nettstedet ditt
```

:::advarsel Sikkerhetsmerknad

* Aldri overfÃ¸r `.env`-filer til versjonskontroll
* Bruk miljÃ¸variabler i produksjon
* Hold bot-tokenet ditt sikkert
  :::

### 5. Installer serveravhengigheter

```bash
cd-server
npm-installasjon
```

### 6. Start backend-serveren

```bash
# Utvikling
npm run dev

# Produksjon
npm start
```

### 7. Distribuer konfigurasjon

For produksjonsdistribusjoner, angi miljÃ¸variabler i hostingplattformen din:

* **Frontend**: Sett `REACT_APP_API_URL` til URL-en for produksjons-API-et ditt
* **Backend**: Distribuer servermappen med bottoken og kanal-ID
* **Database**: SQLite-databasen opprettes automatisk
* **Kontekst**: Konfigurer Discord-kontekstnivÃ¥ og -alternativer i henhold til dine preferanser

## Hvordan det fungerer

### Fullstendig toveis flyt

1. **Kommentar pÃ¥ nettstedet**: Brukeren sender inn kommentar via nettstedskjemaet
2. **Discord-melding**: Boten sender formatert innebygd mappe til Discord-kanalen med full sidekontekst
3. **TrÃ¥doppretting**: Bot oppretter automatisk en trÃ¥d for organiserte svar
4. **Discord-svar**: Discord-brukere svarer i trÃ¥den eller pÃ¥ meldingen
5. **Databaselagring**: Boten lagrer alle kommentarer og svar i SQLite-databasen
6. **Nettstedsvisning**: Frontend-avstemninger i API-et hvert 30. sekund og viser Discord-svar

### Discord-meldingsformat

Discord-embedinger inkluderer:

* **Title**: "ğŸ’¬ New Comment: \{Page Title}"
* **Beskrivelse**: Det faktiske innholdet i kommentaren
* **Forfatter**: Navnet pÃ¥ den som kommenterte
* **URL**: Klikkbar lenke til den nÃ¸yaktige siden
* **Sidefelt**: Viser sidetittel med klikkbar lenke
* **Tidsstempel**: NÃ¥r kommentaren ble publisert
* **TrÃ¥d**: Automatisk opprettet trÃ¥d for svar

### Nettstedvisning

Nettstedet viser:

* **Opprinnelig kommentar**: Innsending av skjema til nettsiden
* **Discord-svar**: Svar fra Discord-brukere med avatarer og brukernavn
* **Oppdateringer i sanntid**: Automatisk avstemning for nye svar
* **TrÃ¥dede samtaler**: Organisert kommentar â†’ svarstruktur

## Kontekstkonfigurasjon

### KontekstnivÃ¥er

Konfigurer hvor mye kontekst som vises i Discord-meldinger:

#### `DISCORD_CONTEXT_LEVEL=minimal`

* **Viser**: Bare sidetittel og kommentarinnhold
* **Brukseksempel**: Rene, enkle meldinger uten ekstra kontekst

#### `DISCORD_CONTEXT_LEVEL=grunnleggende`

* **Viser**: Sidetittel, kommentarinnhold og klikkbar URL til side
* **Brukstilfelle**: Moderat kontekst med viktig informasjon

#### `DISCORD_CONTEXT_LEVEL=full` (standard)

* **Viser**: All kontekstinformasjon, inkludert brÃ¸dsmuler, seksjoner og tidsstempler
* **Brukstilfelle**: Maksimal kontekst for detaljerte diskusjoner

#### `DISCORD_CONTEXT_LEVEL=tilpasset`

* **Viser**: Bare kontekstelementene du aktiverer individuelt
* **Brukseksempel**: Finjustert kontroll over hva som vises

### Individuelle kontekstkontroller

NÃ¥r du bruker `DISCORD_CONTEXT_LEVEL=custom`, kan du kontrollere hvert element:

```env
DISCORD_SHOW_PAGE_CONTEXT=true # Vis sidetittel og URL-felt
DISCORD_SHOW_BREADCRUMBS=true # Vis navigasjonsbrÃ¸dsmuler
DISCORD_SHOW_SECTION_INFO=true # Vis hovedseksjonen (Docker, Nextcloud, osv.)
DISCORD_SHOW_PAGE_PATH=false # Vis fullstendig URL-sti
DISCORD_SHOW_TIMESTAMP=true # Vis nÃ¥r kommentaren ble publisert
DISCORD_SHOW_AUTHOR_FIELD=true # Vis kommentatornavn som forfatter av innebygd innlegg
```

### TrÃ¥dkonfigurasjon

```env
DISCORD_CREATE_THREADS=true # Opprett trÃ¥der for svar
DISCORD_THREAD_DURATION=1440 # Tid for automatisk arkivering av trÃ¥d (minutter)
DISCORD_SITE_NAME=Navn pÃ¥ nettstedet ditt # Nettstedsnavn i bunnteksten
```

### Eksempel pÃ¥ kontekstutganger

**Minimal kontekst:**

```
Docker-installasjonsveiledning
"Denne veiledningen var veldig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"
```

**Grunnleggende kontekst:**

```
ğŸ’¬ Docker-installasjonsveiledning
"Denne veiledningen var veldig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"
[Lenke til side]
```

**Full kontekst:**

```
ğŸ’¬ Ny kommentar: Docker-installasjonsveiledning
ğŸ‘¤ John Doe
"Denne veiledningen var veldig nyttig! Hvordan hÃ¥ndterer jeg portkonflikter?"

ğŸ“„ Side: Docker-installasjonsveiledning
ğŸ“ Navigasjon: Docker > Dokumenter > Installere Docker
ğŸ“‚ Seksjon: Docker
ğŸ”— Sti: /Docker/Dokumenter/Installere%20Docker/Docker%20Eengine

Ditt nettstednavn â€¢ Kommentarsystem
```

## Tilpasning

### Styling

Discord-kommentarkomponenten bruker CSS-moduler. Du kan tilpasse utseendet ved Ã¥ endre:

```
src/komponenter/Discordkommentarer/stiler.modul.css
```

### Meldingsformat

For Ã¥ tilpasse Discord-embed-formatet, rediger `discordMessage`-objektet i:

```
src/komponenter/Discordkommentarer/indeks.tsx
```

### Komponentplassering

Discord-kommentarene vises som standard under Giscus-kommentarene. For Ã¥ endre dette, modifiser:

```
src/tema/DocItem/Layout/index.js
```

## FeilsÃ¸king

### Boten svarer ikke

1. **Sjekk bot-tokenet**: SÃ¸rg for at `DISCORD_BOT_TOKEN` er riktig
2. **Bekreft tillatelser**: SÃ¸rg for at roboten har nÃ¸dvendige tillatelser i kanalen
3. **Sjekk kanal-ID**: SÃ¸rg for at `DISCORD_CHANNEL_ID` er riktig
4. **Bot pÃ¥ server**: Bekreft at boten faktisk er pÃ¥ Discord-serveren din

### Kommentarer vises ikke

1. **Server kjÃ¸rer**: Sjekk om backend-serveren kjÃ¸rer pÃ¥ riktig port
2. **API-URL**: Bekreft at `REACT_APP_API_URL` peker til backend-serveren din
3. **Database**: Sjekk om SQLite-databasen opprettes i servermappen
4. **CORS**: SÃ¸rg for at CORS er konfigurert for frontend-domenet ditt

### Discord-svar vises ikke

1. **Intensjon for meldingsinnhold**: SÃ¸rg for at dette er aktivert i Discord-utviklerportalen
2. **Bot-tillatelser**: Bekreft at boten kan lese meldinger i kanalen
3. **Databasetilkobling**: Sjekk serverlogger for databasefeil
4. **Avstemning**: Avstemninger i frontend hvert 30. sekund â€“ det kan ta litt tid fÃ¸r svarene vises

### MiljÃ¸variabler fungerer ikke

* **Utvikling**: Start bÃ¥de frontend- og backend-servere pÃ¥ nytt
* **Produksjon**: Omdistribuer bÃ¥de frontend og backend med riktige miljÃ¸variabler
* **Prefiks**: Bruk prefikset `REACT_APP_` kun for frontend-variabler

### Databaseproblemer

1. **Filrettigheter**: SÃ¸rg for at serveren kan skrive til databasekatalogen
2. **Diskplass**: Sjekk tilgjengelig diskplass for SQLite-databasen
3. **Serverlogger**: Sjekk serverkonsollen for databasetilkoblingsfeil

## Sikkerhetshensyn

* **Bot-token**: Hold bot-tokenet ditt hemmelig, og bruk aldri versjonskontroll for Ã¥ kontrollere det.
* **Fastebegrensning**: Discord har ratebegrensninger for boter (forskjellig fra webhooks)
* **Inndatavalidering**: BÃ¥de frontend og backend validerer brukerinndata
* **Databasesikkerhet**: SQLite-databasen bÃ¸r beskyttes med riktige filtillatelser
* **API-sikkerhet**: Vurder Ã¥ implementere hastighetsbegrensning pÃ¥ API-endepunktene dine
* **CORS**: Konfigurer CORS riktig for produksjonsdomenet ditt

## Arkitektur

```
Nettstedsgrensesnitt â†â†’ Express API â†â†’ Discord Bot â†â†’ Discord-server
                    â†“
                SQLite-database
```

## Filstruktur

```
prosjekt/
â”œâ”€â”€ src/komponenter/Discordkommentarer/ # Frontend-komponent
â”œâ”€â”€ server/ # Backend-server
â”‚ â”œâ”€â”€ api.js # Express API-server
â”‚ â”œâ”€â”€ discord-bot.js # Discord bot-logikk
â”‚ â”œâ”€â”€ database.js # SQLite-databasefunksjoner
â”‚ â””â”€â”€ pakke.json # Serveravhengigheter
â””â”€â”€ docs/Discord/Dokumenter/ # Dokumentasjon
```

## NettleserstÃ¸tte

Discord-kommentarkomponenten fungerer i alle moderne nettlesere som stÃ¸tter:

* ES6 hente-API
* Reager 18+
* CSS Grid og Flexbox
* Lokal lagring (for skjemapersistens)
